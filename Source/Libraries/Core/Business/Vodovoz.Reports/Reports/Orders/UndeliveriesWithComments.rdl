<?xml version="1.0" encoding="UTF-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <Description></Description>
  <Author></Author>
  <PageHeight>8.5in</PageHeight>
  <PageWidth>11.2in</PageWidth>
  <Width>7.5in</Width>
  <TopMargin>.25in</TopMargin>
  <LeftMargin>.25in</LeftMargin>
  <RightMargin>.25in</RightMargin>
  <BottomMargin>.25in</BottomMargin>
  <PageHeader>
    <Height>33.2pt</Height>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
    <ReportItems>
      <Textbox Name="Textbox29">
        <Height>18.03pt</Height>
        <Width>757.30pt</Width>
        <Value>="Недовозы и комментарии " + Format(Convert.ToDateTime({?start_date}), "dd.MM.yyyy") + Iif({?start_date}={?end_date}, "", " – " + Format(Convert.ToDateTime({?end_date}), "dd.MM.yyyy"))</Value>
        <ZIndex>1</ZIndex>
        <Left>0.00pt</Left>
        <Top>10.60pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <FontWeight>Bold</FontWeight>
          <FontSize>14pt</FontSize>
          <TextAlign>Center</TextAlign>
          <VerticalAlign>Middle</VerticalAlign>
        </Style>
      </Textbox>
    </ReportItems>
  </PageHeader>
  <Body>
    <Height>67.3pt</Height>
    <Columns>1</Columns>
    <ReportItems>
      <Table Name="Table1">
        <DataSetName>UndeliveriesAndComments</DataSetName>
        <NoRows>"=("</NoRows>
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
          <FontSize>8pt</FontSize>
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>18.0pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>37pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>30.6pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>32.3pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>34.0pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>89.1pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>53.2pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>43.1pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>239.8pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>52.3pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>55.9pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>51.4pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>43.8pt</Width>
          </TableColumn>
        </TableColumns>
        <Header>
          <TableRows>
            <TableRow>
              <Height>23.9pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox2">
                      <Value>№</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox8">
                      <Value>Статус недовоза</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox3">
                      <Value>Дата заказа</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox23">
                      <Value>Дата создания недовоза</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox18">
                      <Value>Время создания недовоза</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox16">
                      <Value>Клиент</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox21">
                      <Value>Ответственный</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox4">
                      <Value>Источник проблемы</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox15">
                      <Value>Причина</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox31">
                      <Value>Водитель</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox25">
                      <Value>Вид переноса</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox27">
                      <Value>Штрафы</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox7">
                      <Value>В работе у</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
          <RepeatOnNewPage>true</RepeatOnNewPage>
        </Header>
        <Details>
          <TableRows>
            <TableRow>
              <Height>14pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox5">
                      <Value>=RowNumber()</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <TextAlign>Center</TextAlign>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox14">
                      <Value>={status}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <TextAlign>Center</TextAlign>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox11">
                      <Value>=Fields!old_order_date.Value</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox24">
                      <Value>=Fields!undelivery_creation_date.Value</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingBottom>2pt</PaddingBottom>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingLeft>1pt</PaddingLeft>
                        <PaddingRight>1pt</PaddingRight>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox19">
                      <Value>=Fields!undelivery_creation_time.Value</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingBottom>2pt</PaddingBottom>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingLeft>1pt</PaddingLeft>
                        <PaddingRight>1pt</PaddingRight>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox20">
                      <Value>={client}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingBottom>2pt</PaddingBottom>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingLeft>1pt</PaddingLeft>
                        <PaddingRight>1pt</PaddingRight>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox22">
                      <Value>={guilty}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontSize>6pt</FontSize>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                        <PaddingLeft>1pt</PaddingLeft>
                        <PaddingRight>1pt</PaddingRight>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox12">
                      <Value>={problem_source}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingTop>1pt</PaddingTop>
                        <PaddingBottom>1pt</PaddingBottom>
                        <PaddingLeft>0pt</PaddingLeft>
                        <PaddingRight>0pt</PaddingRight>
                      </Style>
                      <CanGrow>true</CanGrow>
                      <CanShrink>false</CanShrink>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox17">
                      <Value>={reason}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingTop>6pt</PaddingTop>
                        <PaddingBottom>6pt</PaddingBottom>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox34">
                      <Value>=Fields!driver_name.Value</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                        <PaddingLeft>1pt</PaddingLeft>
                        <PaddingRight>1pt</PaddingRight>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox26">
                      <Value>={transfer_type}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox28">
                      <Value>={fines}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox9">
                      <Value>={at_work_sub}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>6pt</FontSize>
                        <VerticalAlign>Middle</VerticalAlign>
                        <TextAlign>Center</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>0pt</Left>
        <Top>0.0pt</Top>
      </Table>
      <Table Name="Table2">
        <DataSetName>Guilty</DataSetName>
        <NoRows>Query returned no rows!</NoRows>
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>666pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>92.7pt</Width>
          </TableColumn>
        </TableColumns>
        <Header>
          <TableRows>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox6">
                      <Value>Ответственные и количество недовозов за выбранный интервал дат:</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                      </Style>
                      <CanGrow>true</CanGrow>
                    </Textbox>
                  </ReportItems>
                  <ColSpan>2</ColSpan>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
          <RepeatOnNewPage>true</RepeatOnNewPage>
        </Header>
        <Details>
          <TableRows>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox10">
                      <Value>=Fields!guilty.Value+":"</Value>
                      <CanGrow>true</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <TextAlign>Right</TextAlign>
                        <VerticalAlign>Middle</VerticalAlign>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox13">
                      <Value>=Fields!qty.Value</Value>
                      <CanGrow>true</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <TextAlign>Left</TextAlign>
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontWeight>Bold</FontWeight>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>0pt</Left>
        <Top>38pt</Top>
        <Visibility>
          <Hidden>=Iif({?are_guilties_filtred}, 'false', 'true')</Hidden>
        </Visibility>
      </Table>
    </ReportItems>
  </Body>
  <PageFooter>
    <Height>14pt</Height>
    <ReportItems>
      <Textbox Name="Textbox1">
        <Top>1pt</Top>
        <Left>10pt</Left>
        <Height>12pt</Height>
        <Width>3in</Width>
        <Value>=Globals!PageNumber + ' of ' + Globals!TotalPages</Value>
        <Style>
          <FontSize>10pt</FontSize>
          <FontWeight>Normal</FontWeight>
        </Style>
      </Textbox>
    </ReportItems>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
  </PageFooter>
  <DataElementName>Report</DataElementName>
  <DataElementStyle>AttributeNormal</DataElementStyle>
  <DataSets>
    <DataSet Name="UndeliveriesAndComments">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <CommandText>
            SELECT
            un_ord_subqry.N,
            un_ord_subqry.old_order_date AS order_by_column,
            DATE_FORMAT(un_ord_subqry.old_order_date, '%e.%m.%y') AS old_order_date,
            DATE_FORMAT(un_ord_subqry.undel_order_creation_date, '%e.%m.%y') AS undelivery_creation_date,
            DATE_FORMAT(un_ord_subqry.undel_order_creation_date, '%H:%S') AS undelivery_creation_time,
            un_ord_subqry.client AS client,
            un_ord_subqry.driver AS driver_name,
            un_ord_subqry.status,
            un_ord_subqry.fines,
            un_ord_subqry.guilty,
            un_ord_subqry.at_work_sub,
            un_ord_subqry.transfer_type,
            un_ord_subqry.problem_source,
            un_ord_subqry.reason
            FROM
            #поля недовоза
            (
            SELECT
            un.id AS N,
            oldo.delivery_date AS old_order_date,
            un.creation_date AS undel_order_creation_date,
            un.new_order_id AS new_order_id,
            coun.name AS client,
            #водители
            IFNULL(
            (SELECT GROUP_CONCAT(
            TRIM(
            BOTH '.'
            FROM CONCAT_WS(
            '.',
            LEFT(employees.name, 1),
            LEFT(employees.patronymic, 1),
            employees.last_name
            )
            )
            ORDER BY route_list_addresses.id
            DESC
            SEPARATOR ', '
            )
            FROM route_list_addresses
            LEFT JOIN route_lists ON route_list_addresses.route_list_id = route_lists.id
            LEFT JOIN employees ON employees.id = route_lists.driver_id
            WHERE route_list_addresses.order_id = oldo.id),
            'Не в МЛ'
            ) AS driver,

            GROUP_CONCAT(
            CASE g.guilty_side
            WHEN 'Client' THEN 'Клиент'
            WHEN 'Driver' THEN 'Водитель'
            WHEN 'Department' THEN IF(dep.name IS NULL, 'Отдел ВВ', dep.name)
            WHEN 'ServiceMan' THEN 'Мастер СЦ'
            WHEN 'ForceMajor' THEN 'Форс-мажор'
            WHEN 'DirectorLO' THEN 'Директор ЛО (Доставка за час)'
            WHEN 'DirectorLOCurrentDayDelivery' THEN 'Директор ЛО (Доставка в тот же день)'
            WHEN 'None' THEN 'Нет (не недовоз)'
            WHEN 'Unknown' THEN 'Неизвестно'
            ELSE g.guilty_side
            END
            SEPARATOR ';\n'
            ) AS guilty,
            CASE un.status
            WHEN 'InProcess' THEN 'В работе'
            WHEN 'Checking' THEN 'На проверке'
            WHEN 'Closed' THEN 'Закрыт'
            END AS status,
            CASE un.transfer_type
            WHEN 'AutoTransferApproved' THEN 'Автоперенос согласован'
            WHEN 'AutoTransferNotApproved' THEN 'Автоперенос н/согл'
            WHEN 'TransferredByCounterparty' THEN 'Перенос клиентом'
            END AS transfer_type,

            GROUP_CONCAT(CONCAT_WS(': ',fine_employee.last_name, fines_items.money) SEPARATOR '\n') AS fines,
            IF(in_work_sub.short_name IS NULL OR in_work_sub.short_name = '', in_work_sub.name, in_work_sub.short_name) as at_work_sub,
            ups.name as problem_source,
            un.reason as reason

            FROM undelivered_orders un
            LEFT JOIN undelivery_problem_sources ups ON ups.id = un.undelivery_problem_source_id
            LEFT JOIN fines ON fines.undelivery_id = un.id
            LEFT JOIN fines_items ON fines_items.fine_id = fines.id
            LEFT JOIN employees AS fine_employee ON fine_employee.id = fines_items.employee_id
            LEFT JOIN subdivisions AS in_work_sub ON in_work_sub.id = un.in_process_at
            LEFT JOIN orders oldo ON un.old_order_id = oldo.id
            LEFT JOIN delivery_schedule old_schedule ON old_schedule.id = oldo.delivery_schedule_id
            LEFT JOIN orders newo ON un.new_order_id = newo.id
            LEFT JOIN delivery_schedule new_schedule ON new_schedule.id = newo.delivery_schedule_id
            LEFT JOIN counterparty coun ON coun.id = oldo.client_id
            LEFT JOIN delivery_points delp ON delp.id = oldo.delivery_point_id
            LEFT JOIN employees oaut ON oaut.id = oldo.author_employee_id
            LEFT JOIN employees ureg ON ureg.id = un.registered_by_employee_id
            LEFT JOIN employees uaut ON uaut.id = un.author_employee_id
            LEFT JOIN guilty_in_undelivered_orders g ON un.id = g.undelivery_id
            LEFT JOIN subdivisions dep ON dep.id = g.guilty_department_id
            LEFT JOIN route_list_addresses rla ON rla.order_id = oldo.id
            LEFT JOIN route_lists rl ON rla.route_list_id = rl.id
            WHERE
            oldo.delivery_date &gt;= @start_date AND oldo.delivery_date &lt;= @end_date
	AND
		(oldo.id = @old_order_id OR @old_order_id = 0)
	AND
		(rl.driver_id = @driver_id AND @driver_id != 0 OR @driver_id = 0)
	AND
		(oldo.client_id = @client_id OR @client_id = 0)
	AND
		(oldo.delivery_point_id = @address_id OR @address_id = 0)
	AND
		(oldo.author_employee_id = @old_order_author_id OR @old_order_author_id = 0)
	AND
		(newo.delivery_date &gt;= @new_order_start_date AND newo.delivery_date &lt;= @new_order_end_date OR @new_order_start_date = '' OR @new_order_end_date = '')
	AND
		(g.guilty_side IN (@guilty_sides) OR '0' IN (@guilty_sides))
	AND
		(g.guilty_department_id = @guilty_department_id OR @guilty_department_id = 0)
	AND
		(un.new_order_id IS NOT NULL AND @new_invoice_created = 'true' OR un.new_order_id IS NULL AND @new_invoice_created = 'false' OR @new_invoice_created = '')
	AND
		(un.status = @undelivery_status OR @undelivery_status = '')
	AND
		(un.undelivered_order_status = @old_order_status OR @old_order_status = '')
	AND
		(un.author_employee_id = @undelivery_author_id OR @undelivery_author_id = 0)
	GROUP BY un.id
	ORDER BY oldo.delivery_date
) AS un_ord_subqry
ORDER BY order_by_column ASC
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>={?start_date}</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>={?end_date}</Value>
          </QueryParameter>
          <QueryParameter Name="old_order_id">
            <Value>={?old_order_id}</Value>
          </QueryParameter>
          <QueryParameter Name="driver_id">
            <Value>={?driver_id}</Value>
          </QueryParameter>
          <QueryParameter Name="client_id">
            <Value>={?client_id}</Value>
          </QueryParameter>
          <QueryParameter Name="address_id">
            <Value>={?address_id}</Value>
          </QueryParameter>
          <QueryParameter Name="old_order_author_id">
            <Value>={?old_order_author_id}</Value>
          </QueryParameter>
          <QueryParameter Name="new_order_start_date">
            <Value>={?new_order_start_date}</Value>
          </QueryParameter>
          <QueryParameter Name="new_order_end_date">
            <Value>={?new_order_end_date}</Value>
          </QueryParameter>
          <QueryParameter Name="guilty_sides">
            <Value>={?guilty_sides}</Value>
          </QueryParameter>
          <QueryParameter Name="guilty_department_id">
            <Value>={?guilty_department_id}</Value>
          </QueryParameter>
          <QueryParameter Name="new_invoice_created">
            <Value>={?new_invoice_created}</Value>
          </QueryParameter>
          <QueryParameter Name="undelivery_status">
            <Value>={?undelivery_status}</Value>
          </QueryParameter>
          <QueryParameter Name="undelivery_author_id">
            <Value>={?undelivery_author_id}</Value>
          </QueryParameter>
          <QueryParameter Name="old_order_status">
            <Value>={?old_order_status}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="N">
          <DataField>N</DataField>
          <TypeName>System.UInt32</TypeName>
        </Field>
        <Field Name="old_order_date">
          <DataField>old_order_date</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="client">
          <DataField>client</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="driver_name">
          <DataField>driver_name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="status">
          <DataField>status</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="fines">
          <DataField>fines</DataField>
        </Field>
        <Field Name="at_work_sub">
          <DataField>at_work_sub</DataField>
        </Field>
        <Field Name="guilty">
          <DataField>guilty</DataField>
        </Field>
        <Field Name="transfer_type">
          <DataField>transfer_type</DataField>
        </Field>
        <Field Name="problem_source">
          <DataField>problem_source</DataField>
        </Field>
        <Field Name="reason">
          <DataField>reason</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="undelivery_creation_date">
          <DataField>undelivery_creation_date</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="undelivery_creation_time">
          <DataField>undelivery_creation_time</DataField>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="Guilty">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <CommandText>SELECT
	COUNT(T1.id) AS qty,
	T1.guilty AS guilty
FROM
	(SELECT
		undelivered_orders.id AS id,
		GROUP_CONCAT(
			CASE g.guilty_side
				WHEN 'Department' THEN IFNULL(CONCAT('Отд: ', d.name), 'Отдел ВВ')
				WHEN 'Client' THEN 'Клиент'
				WHEN 'Driver' THEN 'Водитель'
				WHEN 'ServiceMan' THEN 'Мастер СЦ'
				WHEN 'DirectorLO' THEN 'Директор ЛО (Доставка за час)'
				WHEN 'DirectorLOCurrentDayDelivery' THEN 'Директор ЛО (Доставка в тот же день)'
				WHEN 'None' THEN 'Нет (не недовоз)'
				WHEN 'Unknown' THEN 'Неизвестно'
				ELSE g.guilty_side
			END
			ORDER BY g.guilty_side ASC
			SEPARATOR ' + '
		) AS guilty
	FROM
		undelivered_orders
	LEFT JOIN
		orders oldo ON undelivered_orders.old_order_id = oldo.id
	LEFT JOIN
		guilty_in_undelivered_orders g ON undelivered_orders.id = g.undelivery_id
	LEFT JOIN
		subdivisions d ON d.id = g.guilty_department_id
	WHERE 
		oldo.delivery_date &gt;= @start_date AND oldo.delivery_date &lt;= @end_date
	GROUP BY
		undelivered_orders.id
	) AS T1
GROUP BY
	T1.guilty
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>={?start_date}</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>={?end_date}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="qty">
          <DataField>qty</DataField>
          <TypeName>System.Int64</TypeName>
        </Field>
        <Field Name="guilty">
          <DataField>guilty</DataField>
          <TypeName>System.String</TypeName>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
  <DataSources>
    <DataSource Name="DS1">
      <ConnectionProperties>
        <DataProvider>MySQL.NET</DataProvider>
        <ConnectString>database=Vodovoz;user=;password=;port=3306;server=sql.vod.qsolution.ru</ConnectString>
        <IntegratedSecurity>false</IntegratedSecurity>
      </ConnectionProperties>
    </DataSource>
  </DataSources>
  <ReportParameters>
    <ReportParameter Name="start_date">
      <DataType>String</DataType>
      <DefaultValue>
        <Values>
          <Value>2018-08-01</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="end_date">
      <DataType>String</DataType>
      <DefaultValue>
        <Values>
          <Value>2018-08-23</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="old_order_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="driver_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="client_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="address_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="old_order_author_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="new_order_start_date">
      <DataType>String</DataType>
      <DefaultValue>
        <Values>
          <Value>2017-01-01</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>true</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="new_order_end_date">
      <DataType>String</DataType>
      <DefaultValue>
        <Values>
          <Value>2019-01-01</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>true</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="guilty_sides">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="guilty_department_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="new_invoice_created">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>true</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="undelivery_status">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>true</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="undelivery_author_id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="are_guilties_filtred">
      <DataType>Boolean</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="old_order_status">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>true</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
  </ReportParameters>
</Report>