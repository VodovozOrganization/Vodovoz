<?xml version="1.0" encoding="UTF-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <Description></Description>
  <Author></Author>
  <PageHeight>296mm</PageHeight>
  <PageWidth>209mm</PageWidth>
  <Width>7.5in</Width>
  <TopMargin>5mm</TopMargin>
  <LeftMargin>8mm</LeftMargin>
  <RightMargin>8mm</RightMargin>
  <BottomMargin>5mm</BottomMargin>
  <PageHeader>
    <Height>0.0pt</Height>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
  </PageHeader>
  <Body>
    <Height>433.9pt</Height>
    <ReportItems>
      <Textbox Name="Textbox1">
        <Height>16.54pt</Height>
        <Width>547.28pt</Width>
        <Value>='Отчет по продажам с рентабельностью ' + Iif({?start_date} = {?end_date}, 'за ' + Format(CDate({?start_date}), "dd/MM/yyyy"), 'с ' + Format(CDate({?start_date}), "dd/MM/yyyy") + ' по ' + Format(CDate({?end_date}), "dd/MM/yyyy"))</Value>
        <ZIndex>0</ZIndex>
        <Left>0.00pt</Left>
        <Top>12.00pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <FontSize>11pt</FontSize>
          <TextAlign>Center</TextAlign>
          <VerticalAlign>Middle</VerticalAlign>
          <FontWeight>Bold</FontWeight>
        </Style>
        <Visibility></Visibility>
      </Textbox>
      <Table Name="TableSales">
        <DataSetName>Sales</DataSetName>
        <NoRows>Нет данных</NoRows>
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>191.4pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>55.4pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>52.3pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>58.8pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>58.3pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>63.1pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>63.4pt</Width>
          </TableColumn>
        </TableColumns>
        <Header>
          <TableRows>
            <TableRow>
              <Height>27.7pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="TextboxItemHeader">
                      <Value>={?grouping_title}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox50">
                      <Value>Кол-во, 
штук</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox74">
                      <Value>Кол-во, 
кг</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox79">
                      <Value>Сумма продаж, тыс. руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox114">
                      <Value>Сумма затрат, тыс. руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox119">
                      <Value>Валовая маржа, тыс. руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox124">
                      <Value>Валовая маржа 
в процентах</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
            <TableRow>
              <Height>13pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox4">
                      <Value>Итого:</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format></Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox5">
                      <Value>=Round(Sum({count}), 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox6">
                      <Value>=Round(Sum({total_weight}), 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox7">
                      <Value>=Round(Sum({total_price})/1000, 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox8">
                      <Value>=Round(Sum({total_spending})/1000, 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox9">
                      <Value>=Round(Sum({profitability})/1000, 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox10">
                      <Value>=Round(Sum({profitability})/Sum({total_price})*100, 2)</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
            <TableRow>
              <Height>7.4pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox22">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format></Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox23">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox24">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox25">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox26">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox27">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox28">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
            <TableRow>
              <Height>18.6pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox29">
                      <Value></Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Right</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>8pt</FontSize>
                        <Format></Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox30">
                      <Value>Кол-во, 
штук</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox31">
                      <Value>Кол-во, 
кг</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox32">
                      <Value>Сумма продаж, руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox33">
                      <Value>Сумма затрат, руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox35">
                      <Value>Валовая маржа, руб</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox36">
                      <Value>Валовая маржа 
в процентах</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <Format>0.00</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
          <RepeatOnNewPage>true</RepeatOnNewPage>
        </Header>
        <Details>
          <TableRows>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="TextboxItemData">
                      <Value>={order_item_id}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                        <FontSize>7pt</FontSize>
                        <PaddingBottom>1pt</PaddingBottom>
                        <PaddingTop>1pt</PaddingTop>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox53">
                      <Value>={count}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox75">
                      <Value>={total_weight}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox80">
                      <Value>={total_price}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox115">
                      <Value>={total_spending}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox120">
                      <Value>={profitability}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox125">
                      <Value>={profitability_percent}</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <VerticalAlign>Middle</VerticalAlign>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>7pt</FontSize>
                        <Format>#,##0.00</Format>
                        <TextAlign>Right</TextAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>4.0pt</Left>
        <Top>119.5pt</Top>
        <Footer>
          <TableRows>
            <TableRow>
              <Height>13.7pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox13">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                      </Style>
                      <Value></Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox14">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({count}), 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox15">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({total_weight}), 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox16">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({total_price}), 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox17">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({total_spending}), 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox19">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({profitability}), 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox20">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                        <FontSize>8pt</FontSize>
                        <Format>#,##0.00</Format>
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>=Round(Sum({profitability})/Sum({total_price})*100, 2)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Footer>
      </Table>
      <Textbox Name="Textbox11">
        <Height>25.52pt</Height>
        <Width>246.60pt</Width>
        <Value>=Iif(First({criterions}, "Criterions") = '', 'Не выбраны', First({criterions}, "Criterions"))</Value>
        <ZIndex>0</ZIndex>
        <Left>301.60pt</Left>
        <Top>63.20pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Right</TextAlign>
          <FontSize>8pt</FontSize>
        </Style>
        <CanGrow>true</CanGrow>
        <CanShrink>false</CanShrink>
      </Textbox>
      <fyi:Grid xmlns:fyi="http://www.fyireporting.com/schemas" Name="Grid1">
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>79.0pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>195.5pt</Width>
          </TableColumn>
        </TableColumns>
        <Details>
          <TableRows>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox2">
                      <Value>Сформировано:</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox3">
                      <Value>=Format( {?creation_date}, "dd.MM.yyyy HH:mm")</Value>
                      <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox34">
                      <Value>Настройки отчета:</Value>
                      <CanGrow>false</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox44">
                      <Value>Стандартный отчет</Value>
                      <CanGrow>false</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox48">
                      <Value>Группировка:</Value>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                      <CanGrow>false</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox49">
                      <Value>={?grouping_title}</Value>
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontSize>8pt</FontSize>
                      </Style>
                      <CanGrow>false</CanGrow>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>1.9pt</Left>
        <Top>51.5pt</Top>
      </fyi:Grid>
      <Textbox Name="Textbox12">
        <Height>12.00pt</Height>
        <Width>82.06pt</Width>
        <Value>Фильтры:</Value>
        <ZIndex>0</ZIndex>
        <Left>465.16pt</Left>
        <Top>50.20pt</Top>
        <Style>
          <FontSize>8pt</FontSize>
          <TextAlign>Right</TextAlign>
          <TextDecoration>None</TextDecoration>
        </Style>
      </Textbox>
      <Textbox Name="Textbox21">
        <Height>22.51pt</Height>
        <Width>542.21pt</Width>
        <Value>= 'Внимание! В отчете неверный расчет:\n'
+
Iif(First({missing_cost_purchase_price} = True, 'Sales'), 'Не по всем товарам заполнена себестоимость или цена закупки \n', '')
+
Iif(First({missing_inner_delivery_price} = True , 'Sales'), 'Не по всем товарам заполнены затраты на доставку фурами с производства \n', '')
+
Iif((First({missing_warehouse_expenses_per_kg_on_date} , 'Sales') = True) or (First({missing_administrative_expenses_per_kg_on_date} , 'Sales') = True), 'Не внесены константы ОХР и склада за выбранный период отчета \n', '')
+
Iif(First({missing_route_list_expenses_per_kg} = True, 'Sales'), 'Не по всем МЛ внесена стоимость доставки', '')</Value>
        <ZIndex>0</ZIndex>
        <Left>2.5pt</Left>
        <Top>90.1pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <FontSize>8pt</FontSize>
          <TextAlign>Left</TextAlign>
          <Color>#FF8080</Color>
        </Style>
        <Visibility>
          <Hidden>=!(
(First({missing_cost_purchase_price}, 'Sales') = True)
or (First({missing_inner_delivery_price}, 'Sales') = True)
or (First({missing_warehouse_expenses_per_kg_on_date}, 'Sales') = True) 
or (First({missing_administrative_expenses_per_kg_on_date}, 'Sales') = True) 
or (First({missing_route_list_expenses_per_kg}, 'Sales') = True)
)</Hidden>
        </Visibility>
        <CanGrow>true</CanGrow>
      </Textbox>
    </ReportItems>
    <Columns>1</Columns>
  </Body>
  <PageFooter>
    <Height>15.1pt</Height>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
    <ReportItems>
      <Textbox Name="Textbox18">
        <Height>12.75pt</Height>
        <Width>534.53pt</Width>
        <Value>='Стр. '+{@PageNumber}+' из '+{@TotalPages}</Value>
        <ZIndex>0</ZIndex>
        <Left>13.60pt</Left>
        <Top>0.00pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Right</TextAlign>
          <VerticalAlign>Middle</VerticalAlign>
          <FontSize>8pt</FontSize>
        </Style>
        <CanGrow>false</CanGrow>
        <CanShrink>false</CanShrink>
      </Textbox>
    </ReportItems>
  </PageFooter>
  <DataSets>
    <DataSet Name="Sales">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <Timeout>120</Timeout>
        <CommandText>
# При изменении этого запроса, необходимо внести соответствующие изменения в RouteListRepository.GetRouteListSpendings
SELECT
    c.name AS counterparty,
    CASE WHEN c.counterparty_type = 'Buyer' THEN "Покупатель"
         WHEN c.counterparty_type = 'Supplier' THEN "Поставщик"
         WHEN c.counterparty_type = 'Dealer' THEN "Дилер"
         WHEN c.counterparty_type = 'AdvertisingDepartmentClient' THEN "Клиент РО"
         ELSE ""
         END as counterparty_type,
    CASE WHEN o.payment_type = 'Cash' THEN "Наличная"
         WHEN o.payment_type = 'Terminal' THEN "Терминал"
         WHEN o.payment_type = 'DriverApplicationQR' THEN "МП водителя (QR-код)"
         WHEN o.payment_type = 'SmsQR' THEN "SMS (QR-код)"
         WHEN o.payment_type = 'PaidOnline' THEN "Оплачено онлайн"
         WHEN o.payment_type = 'Barter' THEN "Бартер"
         WHEN o.payment_type = 'ContractDocumentation' THEN "Контрактная документация"
         WHEN o.payment_type = 'Cashless' THEN "Безналичная"
         ELSE ""
         END as payment_type,
    org.name as organization,
    dp.compiled_address_short AS delivery_point,
    rla.route_list_id AS route_list,
    o.delivery_date AS delivery_date,
    e.id AS author_id,
    GET_PERSON_NAME_WITH_INITIALS(e.last_name, e.name, e.patronymic) AS author,
    s.id AS author_subdivision_id,
    s.name AS author_subdivision,
    o.id AS order_id,
    oi.id AS order_item_id,
    n.id AS nomenclature_id,
    n.official_name AS nomenclature_name,
    CASE WHEN n.category = 'rent' THEN "Аренда кулеров"
         WHEN n.category = 'water' THEN IF(n.is_disposable_tare, "Вода в одноразовой таре", "Вода в многооборотной таре")
         WHEN n.category = 'deposit' THEN "Залог"
         WHEN n.category = 'spare_parts' THEN "Запчасти"
         WHEN n.category = 'equipment' THEN "Оборудование"
         WHEN n.category = 'additional' THEN "Товары"
         WHEN n.category = 'service' THEN "Услуга"
         WHEN n.category = 'bottle' THEN "Тара"
         WHEN n.category = 'material' THEN "Сырьё"
         WHEN n.category = 'master' THEN "Выезд мастера"
         ELSE n.category
         END AS nomenclature_category,
    n.weight AS weight,
    IFNULL(oi.actual_count, oi.count) AS items_count,
    (SELECT ((items_count * oi.price) - oi.discount_money)) AS total_price,
    (SELECT (total_price / items_count)) AS order_item_price,
    #Пр-во/закупка - если групповая себестоимость то себестоимость, иначе цена закупки
    (
    	IF(n.using_in_group_price_set,
	    	(
		    	SELECT ncp.cost_price
		    	FROM nomenclature_cost_prices ncp 
		    	WHERE ncp.nomenclature_id = n.id 
			    AND ncp.start_date &lt;= o.delivery_date 
			    AND (ncp.end_date IS NULL OR ncp.end_date &gt; o.delivery_date)
	    	),
	    	(
		    	SELECT npp.purchase_price
		    	FROM nomenclature_purchase_prices npp 
		    	WHERE npp.nomenclature_id = n.id 
		    	AND npp.start_date &lt;= o.delivery_date 
		    	AND (npp.end_date IS NULL OR npp.end_date &gt; o.delivery_date)
	    	)
	    )
	) AS cost_purchase_price_source,
    (SELECT IFNULL(cost_purchase_price_source, '-')) AS cost_purchase_price,
    (SELECT cost_purchase_price_source IS NULL) AS missing_cost_purchase_price,
    #Фура - стоимость доставки до склада
    (
    	SELECT 
    		IFNULL(nidp.price, '-')
		FROM nomenclature_inner_delivery_prices nidp  
		WHERE nidp.nomenclature_id = n.id 
		AND nidp.start_date &lt;= o.delivery_date 
		AND (nidp.end_date IS NULL OR nidp.end_date &gt; o.delivery_date)
    ) AS inner_delivery_price_source,
    (SELECT IF(w.type_of_use = 'Production', 0, IFNULL(inner_delivery_price_source, '-'))) AS inner_delivery_price,
    (SELECT inner_delivery_price_source IS NULL AND n.using_in_group_price_set) AS missing_inner_delivery_price,
    #затраты на адресную доставку на килограмм
    (
		SELECT
			IF(rl.id IS NULL, '-', rlp.route_list_expenses_per_kg)
		FROM
			route_lists rl
			LEFT JOIN
			route_lists_profitabilities rlp ON rlp.id = rl.route_list_profitability_id
		WHERE
			rl.id = rla.route_list_id
	) AS route_list_expenses_per_kg_source,
    (SELECT IF(o.self_delivery, 0, IFNULL(route_list_expenses_per_kg_source, '-'))) AS route_list_expenses_per_kg,
    (SELECT route_list_expenses_per_kg_source IS NULL) AS missing_route_list_expenses_per_kg,
    #складские расходы на килограмм
	(
	    SELECT		
			pc.warehouse_expenses_per_kg
		FROM 
			profitability_constants pc
		WHERE
			YEAR(pc.calculated_month) = YEAR(o.delivery_date) 
			AND MONTH(pc.calculated_month) = MONTH(o.delivery_date)
	) AS warehouse_expenses_per_kg_source,	
	(
		SELECT 
			IFNULL(warehouse_expenses_per_kg_source, 
			(
			    SELECT pc.warehouse_expenses_per_kg
				FROM profitability_constants pc
				ORDER BY pc.calculated_month DESC
				LIMIT 1
			)
		)
	) AS warehouse_expenses_per_kg_last_calc,
	(SELECT IF(w.type_of_use = 'Production', 0, IFNULL(warehouse_expenses_per_kg_last_calc, '-'))) AS warehouse_expenses_per_kg,
	(SELECT warehouse_expenses_per_kg_source IS NULL) AS missing_warehouse_expenses_per_kg_on_date,
	#административные расходы на килограмм
	(
	    SELECT		
			pc.administrative_expenses_per_kg
		FROM 
			profitability_constants pc
		WHERE
			YEAR(pc.calculated_month) = YEAR(o.delivery_date) 
			AND MONTH(pc.calculated_month) = MONTH(o.delivery_date)
	) AS administrative_expenses_per_kg_source,	
	(
		SELECT 
			IFNULL(administrative_expenses_per_kg_source, 
			(
			    SELECT pc.administrative_expenses_per_kg
				FROM profitability_constants pc
				ORDER BY pc.calculated_month DESC
				LIMIT 1
			)
		)
	) AS administrative_expenses_per_kg_last_calc,
	(SELECT IFNULL(administrative_expenses_per_kg_last_calc, '-')) AS administrative_expenses_per_kg,
	(SELECT administrative_expenses_per_kg_source IS NULL) AS missing_administrative_expenses_per_kg_on_date,
	IFNULL(group_levels.level_1_id, 0) as nomen_group_level_1_id,
    IFNULL(group_levels.level_1_name, 'Без группы') as nomen_group_level_1_name,
    IFNULL(group_levels.level_2_id, 0) as nomen_group_level_2_id,
    IFNULL(group_levels.level_2_name, 'Без группы') as nomen_group_level_2_name,
    IFNULL(group_levels.level_3_id, 0) as nomen_group_level_3_id,
    IFNULL(group_levels.level_3_name, 'Без группы') as nomen_group_level_3_name,
    (SELECT weight * items_count) AS total_weight,
	(SELECT IF(warehouse_expenses_per_kg = '-', '-', CAST(weight * warehouse_expenses_per_kg AS DECIMAL(12,2)))) AS warehouse_spending,
	(SELECT IF(administrative_expenses_per_kg = '-', '-', CAST(weight * administrative_expenses_per_kg AS DECIMAL(12,2)))) AS administrative_spending,
	(SELECT IF(route_list_expenses_per_kg = '-', '-', CAST(weight * route_list_expenses_per_kg AS DECIMAL(12,2)))) AS delivery_spending,
	(SELECT 
		IF(cost_purchase_price = '-', 0, cost_purchase_price) + 
		IF(inner_delivery_price = '-', 0, inner_delivery_price) + 
		IF(warehouse_spending = '-', 0, warehouse_spending) + 
		IF(administrative_spending = '-', 0, administrative_spending) + 
		IF(delivery_spending = '-', 0, delivery_spending)
	) AS spending_per_item,
	(SELECT CAST((spending_per_item * items_count) AS DECIMAL(12,2))) AS total_spending,
	(SELECT CAST((total_price - total_spending)  AS DECIMAL(12,2))) AS profitability,
	(SELECT CAST(IFNULL((profitability / total_price * 100), 0) AS DECIMAL(12,2))) AS profitability_percent
FROM
    order_items oi
    LEFT JOIN
    orders o ON order_id = o.id
 	LEFT JOIN
 	route_list_addresses rla ON rla.order_id = o.id AND rla.status  not in ('Transfered', 'Canceled', 'Overdue')
    LEFT JOIN
    nomenclature n ON oi.nomenclature_id = n.id
    LEFT JOIN 
    measurement_units mu ON n.unit_id = mu.id
    LEFT JOIN
    nomenclature_groups ng ON n.group_id = ng.id
    LEFT JOIN
    counterparty c ON o.client_id = c.id
    LEFT JOIN
    delivery_points dp ON o.delivery_point_id = dp.id
    LEFT JOIN
    counterparty_contract cc ON o.counterparty_contract_id = cc.id
    LEFT JOIN
    organizations org ON cc.organization_id = org.id
    LEFT JOIN
    employees e ON o.author_employee_id = e.id
    LEFT JOIN
    subdivisions s ON s.id = e.subdivision_id
    LEFT JOIN
    districts distr ON dp.district_id = distr.id
    LEFT JOIN
    store_car_load_documents scld ON scld.route_list_id = rla.route_list_id
    LEFT JOIN
    warehouses w ON w.id = scld.warehouse_id
    LEFT JOIN
    geo_groups gg ON gg.id = distr.geo_group_id
    LEFT JOIN
    (
	    SELECT 
			groups_with_levels.depth AS depth,
			groups_with_levels.id AS group_id,
			groups_with_levels.name AS group_name,
			groups_with_levels.level_1_id AS level_1_id,
			name_source_1.name AS level_1_name,
			groups_with_levels.level_2_id AS level_2_id,
			name_source_2.name AS level_2_name,
			groups_with_levels.level_3_id AS level_3_id,
			name_source_3.name AS level_3_name
		FROM
			(
				WITH RECURSIVE groups_source (depth, id, parent_id, name, level_1_id, level_2_id, level_3_id) AS (
					SELECT 
						1 AS depth,
						ng.id AS id,
						0 AS parent_id,
						ng.name,
						ng.id AS level_1_id, 
						0 AS level_2_id,
						0 AS level_3_id
				  	FROM nomenclature_groups ng
				  	WHERE ng.parent_id IS NULL
				  UNION
				  	SELECT 
						groups_source.depth + 1 AS depth,
						ng.id AS id,
						groups_source.id AS parent_id,
						ng.name,
						groups_source.level_1_id AS level_1_id,
						IF(groups_source.depth = 1, ng.id, groups_source.level_2_id) AS level_2_id, 
						IF(groups_source.depth = 2, ng.id, groups_source.level_3_id) AS level_3_id
				  	FROM nomenclature_groups ng, groups_source
				  	WHERE ng.parent_id = groups_source.id
				)
				SELECT * FROM groups_source
			) AS groups_with_levels
			LEFT JOIN nomenclature_groups name_source_1 ON name_source_1.id = groups_with_levels.level_1_id
			LEFT JOIN nomenclature_groups name_source_2 ON name_source_2.id = groups_with_levels.level_2_id
			LEFT JOIN nomenclature_groups name_source_3 ON name_source_3.id = groups_with_levels.level_3_id
    ) group_levels ON group_levels.group_id = n.group_id    
WHERE
	(o.delivery_date &gt;= @start_date
	AND o.delivery_date &lt;= @end_date)
	AND !o.is_contract_closer
  AND n.category != 'deposit'
AND (
             (0 IN (@Nomenclature_include) OR (n.id IN (@Nomenclature_include)))
				AND NOT (n.id IN (@Nomenclature_exclude))
         )
       AND (
             ('0' IN (@NomenclatureCategory_include) OR (n.category IN (@NomenclatureCategory_include)))
				AND NOT (n.category IN (@NomenclatureCategory_exclude))
         )
       AND (
             (0 IN (@Counterparty_include) OR (o.client_id IN (@Counterparty_include)))
				AND NOT (o.client_id IN (@Counterparty_exclude))
         )
        AND
        (
            (
                ((('0' IN (@CounterpartyType_include))
                    AND (0 IN (@CounterpartySubtype_include)))
                OR (c.counterparty_type IN (@CounterpartyType_include)))
                AND NOT (c.counterparty_type IN (@CounterpartyType_exclude))
            )
            OR
            (
                ('0' IN (@CounterpartyType_include) OR NOT ('0' IN (@CounterpartySubtype_include)))
                AND c.counterparty_type = 'AdvertisingDepartmentClient'
                AND NOT ('AdvertisingDepartmentClient' IN (@CounterpartyType_exclude))
                AND (0 IN (@CounterpartySubtype_include) OR c.counterparty_subtype_id IN (@CounterpartySubtype_include))
                AND NOT (c.counterparty_subtype_id IN (@CounterpartySubtype_exclude))
            )
        )
       AND (
             (0 IN (@Organization_include) OR (cc.organization_id IN (@Organization_include)))
				AND NOT (cc.organization_id IN (@Organization_exclude))
         )
       AND (
             (0 IN (@DiscountReason_include) OR (oi.discount_reason_id IN (@DiscountReason_include)))
				AND (oi.discount_reason_id IS NULL OR NOT (oi.discount_reason_id IN (@DiscountReason_exclude)))
         )
       AND (
             (0 IN (@Subdivision_include) OR (e.subdivision_id IN (@Subdivision_include)))
				AND NOT (e.subdivision_id IN (@Subdivision_exclude))
         )
       AND (
             (0 IN (@Employee_include) OR (o.author_employee_id IN (@Employee_include)))
				AND NOT (o.author_employee_id IN (@Employee_exclude))
         )
       AND (
             (0 IN (@GeoGroup_include) OR (IFNULL(gg.id, 0) IN (@GeoGroup_include)))
				AND (o.delivery_point_id IS NULL OR NOT (IFNULL(gg.id, 0) IN (@GeoGroup_exclude)))
         )
        AND
        (
            (
                ((('0' IN (@PaymentType_include))
                        AND ('0' IN (@PaymentByTerminalSource_include))
                        AND ('0' IN (@PaymentFrom_include)))
                    OR (o.payment_type IN (@PaymentType_include)))
                AND NOT (o.payment_type IN (@PaymentType_exclude))
            )
            OR
            (
                ((('0' IN (@PaymentType_include))
                    AND ('0' IN (@PaymentFrom_include)))
                    OR NOT ('0' IN (@PaymentByTerminalSource_include)))
                AND o.payment_type = 'Terminal'
                AND NOT ('Terminal' IN (@PaymentType_exclude))
                AND (('0' IN (@PaymentByTerminalSource_include))
                        OR (o.terminal_subtype IN (@PaymentByTerminalSource_include)))
                AND NOT (o.terminal_subtype IN (@PaymentByTerminalSource_exclude))
            )
            OR
            (
                ((('0' IN (@PaymentType_include))
                    AND ('0' IN (@PaymentByTerminalSource_include)))
                    OR NOT ('0' IN (@PaymentFrom_include)))
                AND o.payment_type = 'PaidOnline'
                AND NOT ('PaidOnline' IN (@PaymentType_exclude))
                AND ((0 IN (@PaymentFrom_include))
                        OR (o.payment_from_id IN (@PaymentFrom_include)))
                AND NOT (o.payment_from_id IN (@PaymentFrom_exclude))
            )
        )
       AND (
             (0 IN (@PromotionalSet_include) OR (IFNULL(oi.promotional_set_id, 0) IN (@PromotionalSet_include)))
				AND (oi.promotional_set_id IS NULL OR NOT oi.promotional_set_id IN (@PromotionalSet_exclude))
         )
       AND (
             (0 IN (@ProductGroup_include) OR (IFNULL(ng.id, 0) IN (@ProductGroup_include)))
				AND NOT (IFNULL(ng.id, 0) IN (@ProductGroup_exclude))
         )
	AND (
	        (
            (
              (
                (
                  o.order_status IN (@OrderStatus_include)
                  AND
                  o.order_status != 'WaitForPayment'
                )
                OR
                (
                  o.order_status = 'WaitForPayment' 
                  AND 'WaitForPayment' IN (@OrderStatus_include) 
                  AND self_delivery 
                  AND pay_after_shipment
                )
              )
              AND '0' IN (@OrderStatus_exclude) 
            )
            OR
            (o.order_status NOT IN (@OrderStatus_exclude) AND '0' IN (@OrderStatus_include))
          )
	        OR ('0' IN (@OrderStatus_include) AND '0' IN (@OrderStatus_exclude))
	    )
	GROUP BY oi.id
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>={?start_date}</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>={?end_date}</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_include">
            <Value>={?Nomenclature_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_exclude">
            <Value>={?Nomenclature_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_include">
            <Value>={?NomenclatureCategory_include}</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_exclude">
            <Value>={?NomenclatureCategory_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>={?DiscountReason_include}</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>={?DiscountReason_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>={?Organization_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>={?Organization_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>={?Counterparty_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>={?Counterparty_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>={?Employee_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>={?Employee_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>={?Subdivision_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>={?Subdivision_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>={?GeoGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>={?GeoGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="group_count">
            <Value>={?groups_count}</Value>
          </QueryParameter>
          <QueryParameter Name="group_1">
            <Value>={?group1}</Value>
          </QueryParameter>
          <QueryParameter Name="group_2">
            <Value>={?group2}</Value>
          </QueryParameter>
          <QueryParameter Name="group_3">
            <Value>={?group3}</Value>
          </QueryParameter>
          <QueryParameter Name="OrderStatus_include">
            <Value>={?OrderStatus_include}</Value>
          </QueryParameter>
          <QueryParameter Name="OrderStatus_exclude">
            <Value>={?OrderStatus_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_include">
            <Value>={?PaymentFrom_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_exclude">
            <Value>={?PaymentFrom_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="CounterpartyType_include">
            <Value>={?CounterpartyType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="CounterpartyType_exclude">
            <Value>={?CounterpartyType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="CounterpartySubtype_include">
            <Value>={?CounterpartySubtype_include}</Value>
          </QueryParameter>
          <QueryParameter Name="CounterpartySubtype_exclude">
            <Value>={?CounterpartySubtype_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="counterparty">
          <DataField>counterparty</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="delivery_point">
          <DataField>delivery_point</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="route_list">
          <DataField>route_list</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="delivery_date">
          <DataField>delivery_date</DataField>
          <TypeName>System.DateTime</TypeName>
        </Field>
        <Field Name="author">
          <DataField>author</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="order_id">
          <DataField>order_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomenclature_id">
          <DataField>nomenclature_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomenclature_name">
          <DataField>nomenclature_name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="weight">
          <DataField>weight</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="count">
          <DataField>items_count</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="price">
          <DataField>order_item_price</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="cost_purchase_price">
          <DataField>cost_purchase_price</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="inner_delivery_price">
          <DataField>inner_delivery_price</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="nomen_group_level_3_id">
          <DataField>nomen_group_level_3_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomen_group_level_3_name">
          <DataField>nomen_group_level_3_name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="route_list_expenses_per_kg">
          <DataField>route_list_expenses_per_kg</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="warehouse_expenses_per_kg">
          <DataField>warehouse_expenses_per_kg</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="administrative_expenses_per_kg">
          <DataField>administrative_expenses_per_kg</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="author_subdivision">
          <DataField>author_subdivision</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="author_id">
          <DataField>author_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="author_subdivision_id">
          <DataField>author_subdivision_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomen_group_level_1_id">
          <DataField>nomen_group_level_1_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomen_group_level_1_name">
          <DataField>nomen_group_level_1_name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="nomen_group_level_2_id">
          <DataField>nomen_group_level_2_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="nomen_group_level_2_name">
          <DataField>nomen_group_level_2_name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="order_item_id">
          <DataField>order_item_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="total_weight">
          <DataField>total_weight</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="total_price">
          <DataField>total_price</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="warehouse_spending">
          <DataField>warehouse_spending</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="administrative_spending">
          <DataField>administrative_spending</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="delivery_spending">
          <DataField>delivery_spending</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="spending_per_item">
          <DataField>spending_per_item</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="total_spending">
          <DataField>total_spending</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="profitability">
          <DataField>profitability</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="profitability_percent">
          <DataField>profitability_percent</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="missing_cost_purchase_price">
          <DataField>missing_cost_purchase_price</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="missing_inner_delivery_price">
          <DataField>missing_inner_delivery_price</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="missing_route_list_expenses_per_kg">
          <DataField>missing_route_list_expenses_per_kg</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="missing_warehouse_expenses_per_kg_on_date">
          <DataField>missing_warehouse_expenses_per_kg_on_date</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="missing_administrative_expenses_per_kg_on_date">
          <DataField>missing_administrative_expenses_per_kg_on_date</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="organization">
          <DataField>organization</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="counterparty_type">
          <DataField>counterparty_type</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="payment_type">
          <DataField>payment_type</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="nomenclature_category">
          <DataField>nomenclature_category</DataField>
          <TypeName>System.String</TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="Criterions">
      <Query >
        <DataSourceName>DS1</DataSourceName>
        <Timeout>120</Timeout>
        <CommandText>SELECT
	CONCAT(
		(IF(included_noms!=0,
		CONCAT('Вкл.ном: ',included_noms,'\n'),
		'')),
		(IF(excluded_noms!=0,
		CONCAT('Искл.ном: ',excluded_noms,'\n'),
		'')),
		(IF(included_nomtypes!=0,
		CONCAT('Вкл.типов ном: ',included_nomtypes,'\n'),
		'')),
		(IF(excluded_nomtypes!=0,
		CONCAT('Искл.типов ном: ',excluded_nomtypes,'\n'),
		'')),
		(IF(included_client!=0,
		CONCAT('Вкл.клиентов: ',included_client,'\n'),
		'')),
		(IF(excluded_client!=0,
		CONCAT('Искл.клиентов: ',excluded_client,'\n'),
		'')),
		(IF(included_org!=0,
		CONCAT('Вкл.орг: ',included_org,'\n'),
		'')),
		(IF(excluded_org!=0,
		CONCAT('Искл.орг: ',excluded_org,'\n'),
		'')),
		(IF(included_subdivision!=0,
		CONCAT('Вкл.отделов: ',included_subdivision,'\n'),
		'')),
		(IF(excluded_subdivision!=0,
		CONCAT('Искл.отделов: ',excluded_subdivision,'\n'),
		'')),
		(IF(included_orderauthor!=0,
		CONCAT('Вкл.авторов заказов: ',included_orderauthor,'\n'),
		'')),
		(IF(excluded_orderauthor!=0,
		CONCAT('Искл.авторов заказов: ',excluded_orderauthor,'\n'),
		'')),
		(IF(included_discountreason!=0,
		CONCAT('Вкл.причин скидок: ',included_discountreason,'\n'),
		'')),
		(IF(excluded_discountreason!=0,
		CONCAT('Искл.причин скидок: ',excluded_discountreason,'\n'),
		'')),
		(IF(included_geographic_groups!=0,
		CONCAT('Вкл.частей города: ',included_geographic_groups,'\n'),
		'')),
		(IF(excluded_geographic_groups!=0,
		CONCAT('Искл.частей города: ',excluded_geographic_groups,'\n'),
		'')),
		(IF(included_payment_types!=0,
		CONCAT('Вкл.типов оплаты: ',included_payment_types,'\n'),
		'')),
		(IF(excluded_payment_types!=0,
		CONCAT('Искл.типов оплаты: ',excluded_payment_types,'\n'),
		'')),
        (IF(included_terminal_subtypes!=0,
            CONCAT('Вкл.источников оплаты по терминалу: ',included_terminal_subtypes,'\n'),
            '')),
        (IF(excluded_terminal_subtypes!=0,
            CONCAT('Искл.источников оплаты по терминалу: ',excluded_terminal_subtypes,'\n'),
            '')),
        (IF(included_payment_froms!=0,
            CONCAT('Вкл.источников оплаты: ',included_payment_froms,'\n'),
            '')),
        (IF(excluded_payment_froms!=0,
            CONCAT('Искл.источников оплаты: ',excluded_payment_froms,'\n'),
            '')),
		(IF(included_promo_sets!=0,
		CONCAT('Вкл.промо-наборов: ',included_promo_sets,'\n'),
		'')),
		(IF(excluded_promo_sets!=0,
		CONCAT('Искл.промо-наборов: ',excluded_promo_sets,'\n'),
		'')),
		(IF(included_product_groups!=0,
		CONCAT('Вкл.групп товаров: ',included_product_groups,'\n'),
		'')),
        (IF(included_order_statuses!=0,
		CONCAT('Вкл.статусов заказов: ',included_order_statuses,'\n'),
		'')),
		(IF(excluded_order_statuses!=0,
		CONCAT('Искл.статусов заказов: ',excluded_order_statuses,'\n'),
		''))
	) AS criterions
FROM
	(SELECT
		IF(
			0 NOT IN (@Nomenclature_include),
			(SELECT COUNT(id) FROM nomenclature WHERE nomenclature.id IN(@Nomenclature_include)),
			0
		) AS included_noms,
		IF(
			0 NOT IN (@Nomenclature_exclude),
			(SELECT COUNT(id) FROM nomenclature WHERE nomenclature.id IN(@Nomenclature_exclude)),
			0
		) AS excluded_noms,

		IF(
			'0' NOT IN (@NomenclatureCategory_include),
			(SELECT COUNT(q.cat) FROM (SELECT COUNT(nomenclature.category) AS cat FROM nomenclature WHERE nomenclature.category IN(@NomenclatureCategory_include) GROUP BY nomenclature.category) AS q),
			0
		) AS included_nomtypes,
		IF(
			'0' NOT IN (@NomenclatureCategory_exclude),
			(SELECT COUNT(q.cat) FROM (SELECT COUNT(nomenclature.category) AS cat FROM nomenclature WHERE nomenclature.category IN(@NomenclatureCategory_exclude) GROUP BY nomenclature.category) AS q),
			0
		) AS excluded_nomtypes,

		IF(
			0 NOT IN (@Counterparty_include),
			(SELECT COUNT(id) FROM counterparty WHERE counterparty.id IN(@Counterparty_include)),
			0
		) AS included_client,
		IF(
			0 NOT IN (@Counterparty_exclude),
			(SELECT COUNT(id) FROM counterparty WHERE counterparty.id IN(@Counterparty_exclude)),
			0
		) AS excluded_client,

		IF(
			0 NOT IN (@Organization_include),
			(SELECT COUNT(id) FROM organizations WHERE organizations.id IN(@Organization_include)),
			0
		) AS included_org,
		IF(
			0 NOT IN (@Organization_exclude),
			(SELECT COUNT(id) FROM organizations WHERE organizations.id IN(@Organization_exclude)),
			0
		) AS excluded_org,

		IF(
			0 NOT IN (@Subdivision_include),
			(SELECT COUNT(id) FROM subdivisions WHERE subdivisions.id IN(@Subdivision_include)),
			0
		) AS included_subdivision,
		IF(
			0 NOT IN (@Subdivision_exclude),
			(SELECT COUNT(id) FROM subdivisions WHERE subdivisions.id IN(@Subdivision_exclude)),
			0
		) AS excluded_subdivision,

		IF(
			0 NOT IN (@Employee_include),
			(SELECT COUNT(id) FROM employees WHERE employees.id IN(@Employee_include)),
			0
		) AS included_orderauthor,
		IF(
			0 NOT IN (@Employee_exclude),
			(SELECT COUNT(id) FROM employees WHERE employees.id IN(@Employee_exclude)),
			0
		) AS excluded_orderauthor,

		IF(
			0 NOT IN (@DiscountReason_include),
			(SELECT COUNT(id) FROM discount_reasons WHERE discount_reasons.id IN(@DiscountReason_include)),
			0
		) AS included_discountreason,
		IF(
			0 NOT IN (@DiscountReason_exclude),
			(SELECT COUNT(id) FROM discount_reasons WHERE discount_reasons.id IN(@DiscountReason_exclude)),
			0
		) AS excluded_discountreason,

		IF(
			0 NOT IN (@GeoGroup_include),
			(SELECT COUNT(@GeoGroup_include)),
			0
		) AS included_geographic_groups,
		IF(
			0 NOT IN (@GeoGroup_exclude),
			(SELECT COUNT(@GeoGroup_exclude)),
			0
		) AS excluded_geographic_groups,
		
		IF(
			'0' NOT IN (@PaymentType_include),
			(SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_type) AS pay FROM orders WHERE orders.payment_type IN(@PaymentType_include) GROUP BY orders.payment_type) AS q),
			0
		) AS included_payment_types,
		IF(
			'0' NOT IN (@PaymentType_exclude),
			(SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_type) AS pay FROM orders WHERE orders.payment_type IN(@PaymentType_exclude) GROUP BY orders.payment_type) AS q),
			0
		) AS excluded_payment_types,
         IF(
                 '0' NOT IN (@PaymentByTerminalSource_include),
                 (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.terminal_subtype) AS pay FROM orders WHERE orders.terminal_subtype IN(@PaymentByTerminalSource_include) GROUP BY orders.terminal_subtype) AS q),
                 0
         ) AS included_terminal_subtypes,
         IF(
                     '0' NOT IN (@PaymentByTerminalSource_exclude),
                     (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.terminal_subtype) AS pay FROM orders WHERE orders.terminal_subtype IN(@PaymentByTerminalSource_exclude) GROUP BY orders.terminal_subtype) AS q),
                     0
             ) AS excluded_terminal_subtypes,
         IF(
                 '0' NOT IN (@PaymentFrom_include),
                 (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_from_id) AS pay FROM orders WHERE orders.payment_from_id IN(@PaymentFrom_include) GROUP BY orders.payment_from_id) AS q),
                 0
         ) AS included_payment_froms,
         IF(
                     '0' NOT IN (@PaymentFrom_exclude),
                     (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_from_id) AS pay FROM orders WHERE orders.payment_from_id IN(@PaymentFrom_exclude) GROUP BY orders.payment_from_id) AS q),
                     0
         ) AS excluded_payment_froms,	
		IF(
			0 NOT IN (@PromotionalSet_include),
			(SELECT COUNT(id) FROM promotional_sets WHERE promotional_sets.id IN(@PromotionalSet_include)),
			0
		) AS included_promo_sets,
		IF(
			0 NOT IN (@PromotionalSet_exclude),
			(SELECT COUNT(id) FROM promotional_sets WHERE promotional_sets.id IN(@PromotionalSet_exclude)),
			0
		) AS excluded_promo_sets,
		IF(
            0 NOT IN (@ProductGroup_include),
            (SELECT COUNT(id) FROM nomenclature_groups WHERE nomenclature_groups.id IN(@ProductGroup_include)),
            0
        ) AS included_product_groups,
        IF(
            0 NOT IN (@ProductGroup_exclude),
            (SELECT COUNT(id) FROM nomenclature_groups WHERE nomenclature_groups.id IN(@ProductGroup_exclude)),
            0
        ) AS excluded_product_groups,
        IF(
			'0' NOT IN (@OrderStatus_include),
			(SELECT COUNT(q.cat) FROM (SELECT COUNT(orders.order_status) AS cat FROM orders WHERE orders.order_status IN(@OrderStatus_include) GROUP BY orders.order_status) AS q),
			0
		) AS included_order_statuses,
		IF(
			'0' NOT IN (@OrderStatus_exclude),
			(SELECT COUNT(q.cat) FROM (SELECT COUNT(orders.order_status) AS cat FROM orders WHERE orders.order_status IN(@OrderStatus_exclude) GROUP BY orders.order_status) AS q),
			0
		) AS excluded_order_statuses
	) AS tbl
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>=Parameters!start_date</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>=Parameters!end_date</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_include">
            <Value>=Parameters!Nomenclature_include</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_exclude">
            <Value>=Parameters!Nomenclature_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_include">
            <Value>=Parameters!NomenclatureCategory_include</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_exclude">
            <Value>=Parameters!NomenclatureCategory_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>=Parameters!DiscountReason_include</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>=Parameters!DiscountReason_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>=Parameters!Organization_include</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>=Parameters!Organization_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>=Parameters!Counterparty_include</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>=Parameters!Counterparty_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>=Parameters!Employee_include</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>=Parameters!Employee_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>=Parameters!Subdivision_include</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>=Parameters!Subdivision_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>=Parameters!GeoGroup_include</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>=Parameters!GeoGroup_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="OrderStatus_include">
            <Value>={?OrderStatus_include}</Value>
          </QueryParameter>
          <QueryParameter Name="OrderStatus_exclude">
            <Value>={?OrderStatus_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_include">
            <Value>={?PaymentFrom_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_exclude">
            <Value>={?PaymentFrom_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields >
        <Field Name="criterions">
          <DataField>criterions</DataField>
          <TypeName>System.String</TypeName>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
  <DataSources>
    <DataSource Name="DS1">
      <ConnectionProperties>
        <DataProvider>MySqlConnector</DataProvider>
        <ConnectString></ConnectString>
        <IntegratedSecurity>false</IntegratedSecurity>
      </ConnectionProperties>
    </DataSource>
  </DataSources>
  <DataElementName>Report</DataElementName>
  <DataElementStyle>AttributeNormal</DataElementStyle>
  <ReportParameters>
    <ReportParameter Name="start_date">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="end_date">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="creation_date">
      <DataType>DateTime</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Nomenclature_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Nomenclature_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="NomenclatureCategory_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="NomenclatureCategory_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Counterparty_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Counterparty_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Organization_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Organization_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Subdivision_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Subdivision_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Employee_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Employee_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="DiscountReason_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="DiscountReason_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="GeoGroup_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="GeoGroup_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentType_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentType_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentByTerminalSource_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentByTerminalSource_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentFrom_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentFrom_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PromotionalSet_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PromotionalSet_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="ProductGroup_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="ProductGroup_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="OrderStatus_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="OrderStatus_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="CounterpartyType_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="CounterpartyType_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="CounterpartySubtype_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="CounterpartySubtype_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="group1">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="group2">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="group3">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="groups_count">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="grouping_title">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
  </ReportParameters>
</Report>