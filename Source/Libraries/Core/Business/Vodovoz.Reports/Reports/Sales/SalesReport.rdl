<?xml version="1.0" encoding="UTF-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <Description></Description>
  <Author></Author>
  <PageHeight>296.926mm</PageHeight>
  <PageWidth>209.804mm</PageWidth>
  <Width>7.5in</Width>
  <TopMargin>5mm</TopMargin>
  <LeftMargin>5mm</LeftMargin>
  <RightMargin>5mm</RightMargin>
  <BottomMargin>5mm</BottomMargin>
  <PageHeader>
    <Height>0.0pt</Height>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
  </PageHeader>
  <Body>
    <Height>327.5pt</Height>
    <ReportItems>
      <Textbox Name="Textbox1">
        <Height>24.05pt</Height>
        <Width>568.40pt</Width>
        <Value>='Отчет по продажам ' + Iif(Parameters!start_date = Parameters!end_date, 'за ' + Format(CDate(Parameters!start_date), "dd/MM/yyyy"), 'с ' + Format(CDate(Parameters!start_date), "dd/MM/yyyy") + ' по ' + Format(CDate(Parameters!end_date), "dd/MM/yyyy"))</Value>
        <ZIndex>0</ZIndex>
        <Left>0.00pt</Left>
        <Top>21.90pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <FontSize>16pt</FontSize>
          <TextAlign>Center</TextAlign>
        </Style>
      </Textbox>
      <Table Name="Table1">
        <DataSetName>Sales</DataSetName>
        <NoRows>Query returned no rows!</NoRows>
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>339.7pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>98.7pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>109.7pt</Width>
          </TableColumn>
        </TableColumns>
        <Header>
          <TableRows>
            <TableRow>
              <Height>11.3pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox2">
                      <Value>Номенклатура</Value>
                      <Style>
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox3">
                      <Value>Количество</Value>
                      <Style>
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox4">
                      <Value>Сумма</Value>
                      <Style>
                        <TextAlign>Center</TextAlign>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontWeight>Bold</FontWeight>
                        <BorderColor />
                        <BorderWidth />
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
          <RepeatOnNewPage>true</RepeatOnNewPage>
        </Header>
        <Details>
          <TableRows>
            <TableRow>
              <Height>12 pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox5">
                      <Value>=Fields!name.Value</Value>
                      <CanGrow>true</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox6">
                      <Value>=Fields!total_count.Value</Value>
                      <CanGrow>true</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <Format>='N' + {digits}</Format>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox7">
                      <Value>=Fields!total_sum.Value</Value>
                      <CanGrow>true</CanGrow>
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>10.5pt</Left>
        <Top>47.4pt</Top>
        <Footer>
          <TableRows>
            <TableRow>
              <Height>.2in</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox8">
                      <Style>
                        <BorderStyle>
                          <Default>None</Default>
                          <Left>None</Left>
                          <Right>None</Right>
                          <Top>None</Top>
                          <Bottom>None</Bottom>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <TextAlign>Right</TextAlign>
                        <FontWeight>Bold</FontWeight>
                      </Style>
                      <Value>Итого:</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox9">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                      </Style>
                      <Value>=Sum(Fields!total_count.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox10">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <FontWeight>Bold</FontWeight>
                      </Style>
                      <Value>=Sum(Fields!total_sum.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Footer>
        <TableGroups>
          <TableGroup>
            <Grouping Name="CategoryGroup">
              <PageBreakAtStart>false</PageBreakAtStart>
              <PageBreakAtEnd>false</PageBreakAtEnd>
              <GroupExpressions>
                <GroupExpression>={is_disposable_tare}</GroupExpression>
                <GroupExpression>=Fields!category.Value</GroupExpression>
              </GroupExpressions>
            </Grouping>
            <Header>
              <RepeatOnNewPage>true</RepeatOnNewPage>
              <TableRows>
                <TableRow>
                  <Height>.2in</Height>
                  <TableCells>
                    <TableCell>
                      <ReportItems>
                        <Textbox Name="Textbox23">
                          <Value>=Switch(
    Fields!category.Value = 'rent', 'Аренда кулеров',
    Fields!category.Value = 'water' AND Fields!is_disposable_tare.Value = true, 'Вода в одноразовой таре',
    Fields!category.Value = 'water' AND Fields!is_disposable_tare.Value = false, 'Вода в многооборотной таре',
    Fields!category.Value = 'deposit', 'Залог',
    Fields!category.Value = 'spare_parts', 'Запчасти',
    Fields!category.Value = 'equipment', 'Оборудование',
    Fields!category.Value = 'additional', 'Товары',
    Fields!category.Value = 'service', 'Услуга',
    Fields!category.Value = 'bottle', 'Тара',
    Fields!category.Value = 'material', 'Сырьё',
    Fields!category.Value = 'master', 'Выезд мастера',
    true, Fields!category.Value
)</Value>
                          <Style xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
                            <BorderStyle>
                              <Default>Solid</Default>
                            </BorderStyle>
                            <BorderColor />
                            <BorderWidth />
                            <FontWeight>Bold</FontWeight>
                            <FontSize>11pt</FontSize>
                          </Style>
                        </Textbox>
                      </ReportItems>
                      <ColSpan>3</ColSpan>
                    </TableCell>
                  </TableCells>
                </TableRow>
              </TableRows>
            </Header>
            <Footer>
              <RepeatOnNewPage>false</RepeatOnNewPage>
              <TableRows>
                <TableRow>
                  <Height>.2in</Height>
                  <TableCells>
                    <TableCell>
                      <ReportItems>
                        <Textbox Name="Textbox14">
                          <Style>
                            <BorderStyle>
                              <Default>None</Default>
                              <Left>None</Left>
                              <Right>None</Right>
                              <Top>None</Top>
                              <Bottom>None</Bottom>
                            </BorderStyle>
                            <BorderColor />
                            <BorderWidth />
                            <TextAlign>Right</TextAlign>
                            <FontWeight>Bold</FontWeight>
                          </Style>
                          <Value>Всего по виду:</Value>
                        </Textbox>
                      </ReportItems>
                    </TableCell>
                    <TableCell>
                      <ReportItems>
                        <Textbox Name="Textbox15">
                          <Style>
                            <BorderStyle>
                              <Default>Solid</Default>
                            </BorderStyle>
                            <BorderColor />
                            <BorderWidth />
                            <FontWeight>Bold</FontWeight>
                          </Style>
                          <Value>=Sum(Fields!total_count.Value)</Value>
                        </Textbox>
                      </ReportItems>
                    </TableCell>
                    <TableCell>
                      <ReportItems>
                        <Textbox Name="Textbox16">
                          <Style>
                            <BorderStyle>
                              <Default>Solid</Default>
                            </BorderStyle>
                            <BorderColor />
                            <BorderWidth />
                            <FontWeight>Bold</FontWeight>
                          </Style>
                          <Value>=Sum(Fields!total_sum.Value)</Value>
                        </Textbox>
                      </ReportItems>
                    </TableCell>
                  </TableCells>
                </TableRow>
              </TableRows>
            </Footer>
          </TableGroup>
        </TableGroups>
      </Table>
      <Textbox Name="Textbox11" xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
        <Height>13.51pt</Height>
        <Width>223.58pt</Width>
        <Value>=First({criterions}, "Criterions")</Value>
        <ZIndex>0</ZIndex>
        <Left>335.60pt</Left>
        <Top>119.10pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Right</TextAlign>
        </Style>
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
      </Textbox>
      <fyi:Grid xmlns:fyi="http://www.fyireporting.com/schemas" Name="Grid1">
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
          <BorderColor />
          <BorderWidth />
        </Style>
        <TableColumns>
          <TableColumn>
            <Width>416.0pt</Width>
          </TableColumn>
          <TableColumn>
            <Width>133.8pt</Width>
          </TableColumn>
        </TableColumns>
        <Details>
          <TableRows>
            <TableRow>
              <Height>14.1pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox22">
                      <Value>Фактически забранная тара</Value>
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox25">
                      <Value>=First( {fact} , "bottles" )</Value>
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Details>
        <Left>7.9pt</Left>
        <Top>152.9pt</Top>
        <Footer>
          <TableRows>
            <TableRow>
              <Height>13.7pt</Height>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox26">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                        <VerticalAlign>Middle</VerticalAlign>
                      </Style>
                      <Value>Планируемая тара</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Textbox28">
                      <Style>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <BorderColor />
                        <BorderWidth />
                      </Style>
                      <Value>=First( {plan} , "bottles" )</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
            </TableRow>
          </TableRows>
        </Footer>
      </fyi:Grid>
      <Textbox Name="Textbox17">
        <Height>12pt</Height>
        <Width>265pt</Width>
        <Value>="Сформировано: " + Format( {?creation_date}, "dd-MM-yyyy HH:mm")</Value>
        <ZIndex>0</ZIndex>
        <Left>300pt</Left>
        <Top>0.00pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Right</TextAlign>
        </Style>
      </Textbox>
      <Textbox Name="Textbox13" xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
        <Height>13.51pt</Height>
        <Width>223.58pt</Width>
        <Value>="Количество заказов: " + First({count}, "orders_count")</Value>
        <ZIndex>0</ZIndex>
        <Left>335.5pt</Left>
        <Top>135.7pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Right</TextAlign>
        </Style>
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
      </Textbox>
    </ReportItems>
    <Columns>1</Columns>
  </Body>
  <PageFooter>
    <Height>13.2pt</Height>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <PrintOnLastPage>true</PrintOnLastPage>
    <ReportItems>
      <Textbox Name="Textbox12" xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition">
        <Height>12.05pt</Height>
        <Width>565.41pt</Width>
        <Value>='Стр. '+{@PageNumber}+' из '+{@TotalPages}</Value>
        <ZIndex>0</ZIndex>
        <Left>0.00pt</Left>
        <Top>0.00pt</Top>
        <Style>
          <BorderStyle />
          <BorderColor />
          <BorderWidth />
          <TextAlign>Center</TextAlign>
          <VerticalAlign>Middle</VerticalAlign>
        </Style>
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
      </Textbox>
    </ReportItems>
  </PageFooter>
  <DataSets>
    <DataSet Name="Sales">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <Timeout>600</Timeout>
        <CommandText>SELECT
    T.counterparty,
    T.delivery_point,
    T.order_id,
    COUNT(DISTINCT T.order_id) as orders_count,
    T.name,
    SUM(T.total_count) AS total_count,
    SUM(T.total_sum) AS total_sum,
    T.category,
    T.is_disposable_tare,
    T.nomenclature_id as nomenclature_id,
    T.digits
FROM
    (SELECT
         counterparty.name as counterparty,
         delivery_points.compiled_address as delivery_point,
         orders.id as order_id,
         nomenclature.official_name AS name,
         IFNULL(order_items.actual_count, order_items.count) AS total_count,
         truncate(IFNULL(order_items.actual_count, order_items.count) * order_items.price - order_items.discount_money, 2) AS total_sum,
         nomenclature.category,
         nomenclature.is_disposable_tare,
         nomenclature.id as nomenclature_id,
         measurement_units.digits as digits,
         gg.id
     FROM
         order_items
             LEFT JOIN
         orders ON order_id = orders.id
             LEFT JOIN
         nomenclature ON order_items.nomenclature_id = nomenclature.id
             LEFT JOIN 
         measurement_units ON nomenclature.unit_id = measurement_units.id
             LEFT JOIN
         nomenclature_groups ON nomenclature.group_id = nomenclature_groups.id
             LEFT JOIN
         counterparty ON orders.client_id = counterparty.id
             LEFT JOIN
         delivery_points ON orders.delivery_point_id = delivery_points.id
             LEFT JOIN
         counterparty_contract ON orders.counterparty_contract_id = counterparty_contract.id
             LEFT JOIN
         employees ON orders.author_employee_id = employees.id
             LEFT JOIN
         districts distr ON delivery_points.district_id = distr.id
             LEFT JOIN
         geo_groups gg ON gg.id = distr.geo_group_id
     WHERE
         (order_status = 'Accepted'
             OR order_status = 'InTravelList'
             OR order_status = 'OnLoading'
             OR order_status = 'OnTheWay'
             OR order_status = 'Shipped'
             OR order_status = 'UnloadingOnStock'
             OR order_status = 'Closed'
             OR (order_status = 'WaitForPayment' AND self_delivery AND pay_after_shipment)
             )
       AND (delivery_date &gt;= @start_date
         AND delivery_date &lt;= @end_date)
       AND !orders.is_contract_closer
       AND (
             (0 IN (@Nomenclature_include) OR (nomenclature.id IN (@Nomenclature_include)))
				AND NOT (nomenclature.id IN (@Nomenclature_exclude))
         )
       AND (
             ('0' IN (@NomenclatureCategory_include) OR (nomenclature.category IN (@NomenclatureCategory_include)))
				AND NOT (nomenclature.category IN (@NomenclatureCategory_exclude))
         )
       AND (
             (0 IN (@Counterparty_include) OR (orders.client_id IN (@Counterparty_include)))
				AND NOT (orders.client_id IN (@Counterparty_exclude))
         )
       AND (
             (0 IN (@Organization_include) OR (counterparty_contract.organization_id IN (@Organization_include)))
				AND NOT (counterparty_contract.organization_id IN (@Organization_exclude))
         )
       AND (
             (0 IN (@DiscountReason_include) OR (order_items.discount_reason_id IN (@DiscountReason_include)))
				AND (order_items.discount_reason_id IS NULL OR NOT (order_items.discount_reason_id IN (@DiscountReason_exclude)))
         )
       AND (
             (0 IN (@Subdivision_include) OR (employees.subdivision_id IN (@Subdivision_include)))
				AND NOT (employees.subdivision_id IN (@Subdivision_exclude))
         )
       AND (
             (0 IN (@Employee_include) OR (orders.author_employee_id IN (@Employee_include)))
				AND NOT (orders.author_employee_id IN (@Employee_exclude))
         )
       AND (
             (0 IN (@GeoGroup_include) OR (IFNULL(gg.id, 0) IN (@GeoGroup_include)))
				AND (orders.delivery_point_id IS NULL OR NOT (IFNULL(gg.id, 0) IN (@GeoGroup_exclude)))
         )
       AND
       (
         	(
         	   ('0' IN (@PaymentType_include) OR (orders.payment_type IN (@PaymentType_include)))
				AND NOT (orders.payment_type IN (@PaymentType_exclude))
         	)
            OR
         	(
         		('0' IN (@PaymentType_include) OR NOT ('0' IN (@PaymentByTerminalSource_include)))
         		AND orders.payment_type = 'Terminal'
                AND NOT ('Terminal' IN (@PaymentType_exclude))
                AND ('0' IN (@PaymentByTerminalSource_include) OR orders.terminal_subtype IN (@PaymentByTerminalSource_include))
         		AND NOT (orders.terminal_subtype IN (@PaymentByTerminalSource_exclude))
         	)
            OR
         	(
         		('0' IN (@PaymentType_include) OR NOT ('0' IN (@PaymentFrom_include)))
                AND orders.payment_type = 'PaidOnline'
                AND NOT ('PaidOnline' IN (@PaymentFrom_exclude))
                AND (0 IN (@PaymentFrom_include) OR orders.payment_from_id IN (@PaymentFrom_include))
         		AND NOT (orders.payment_from_id IN (@PaymentFrom_exclude))
         	)
       )
       AND (
             (0 IN (@PromotionalSet_include) OR (IFNULL(order_items.promotional_set_id, 0) IN (@PromotionalSet_include)))
				AND (order_items.promotional_set_id IS NULL OR NOT order_items.promotional_set_id IN (@PromotionalSet_exclude))
         )
       AND (
             (0 IN (@ProductGroup_include) OR (IFNULL(nomenclature_groups.id, 0) IN (@ProductGroup_include)))
				AND NOT (IFNULL(nomenclature_groups.id, 0) IN (@ProductGroup_exclude))
         )
     GROUP BY order_items.id
    ) as T
GROUP BY nomenclature_id
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>=Parameters!start_date</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>=Parameters!end_date</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_include">
            <Value>=Parameters!Nomenclature_include</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_exclude">
            <Value>=Parameters!Nomenclature_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_include">
            <Value>=Parameters!NomenclatureCategory_include</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_exclude">
            <Value>=Parameters!NomenclatureCategory_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>=Parameters!DiscountReason_include</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>=Parameters!DiscountReason_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>=Parameters!Organization_include</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>=Parameters!Organization_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>=Parameters!Counterparty_include</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>=Parameters!Counterparty_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>=Parameters!Employee_include</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>=Parameters!Employee_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>=Parameters!Subdivision_include</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>=Parameters!Subdivision_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>=Parameters!GeoGroup_include</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>=Parameters!GeoGroup_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_include">
            <Value>={?PaymentFrom_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentFrom_exclude">
            <Value>={?PaymentFrom_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="name">
          <DataField>name</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="total_count">
          <DataField>total_count</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="total_sum">
          <DataField>total_sum</DataField>
          <TypeName>System.Decimal</TypeName>
        </Field>
        <Field Name="category">
          <DataField>category</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="counterparty">
          <DataField>counterparty</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="delivery_point">
          <DataField>delivery_point</DataField>
          <TypeName>System.String</TypeName>
        </Field>
        <Field Name="order_id">
          <DataField>order_id</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="is_disposable_tare">
          <DataField>is_disposable_tare</DataField>
          <TypeName>System.Boolean</TypeName>
        </Field>
        <Field Name="orders_count">
          <DataField>orders_count</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
        <Field Name="digits">
          <DataField>digits</DataField>
          <TypeName>System.UInt32</TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="Criterions">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <Timeout>600</Timeout>
        <CommandText>SELECT
    CONCAT(
            (IF(included_noms!=0,
                CONCAT('Вкл.ном: ',included_noms,'\n'),
                '')),
            (IF(excluded_noms!=0,
                CONCAT('Искл.ном: ',excluded_noms,'\n'),
                '')),
            (IF(included_nomtypes!=0,
                CONCAT('Вкл.типов ном: ',included_nomtypes,'\n'),
                '')),
            (IF(excluded_nomtypes!=0,
                CONCAT('Искл.типов ном: ',excluded_nomtypes,'\n'),
                '')),
            (IF(included_client!=0,
                CONCAT('Вкл.клиентов: ',included_client,'\n'),
                '')),
            (IF(excluded_client!=0,
                CONCAT('Искл.клиентов: ',excluded_client,'\n'),
                '')),
            (IF(included_org!=0,
                CONCAT('Вкл.орг: ',included_org,'\n'),
                '')),
            (IF(excluded_org!=0,
                CONCAT('Искл.орг: ',excluded_org,'\n'),
                '')),
            (IF(included_subdivision!=0,
                CONCAT('Вкл.отделов: ',included_subdivision,'\n'),
                '')),
            (IF(excluded_subdivision!=0,
                CONCAT('Искл.отделов: ',excluded_subdivision,'\n'),
                '')),
            (IF(included_orderauthor!=0,
                CONCAT('Вкл.авторов заказов: ',included_orderauthor,'\n'),
                '')),
            (IF(excluded_orderauthor!=0,
                CONCAT('Искл.авторов заказов: ',excluded_orderauthor,'\n'),
                '')),
            (IF(included_discountreason!=0,
                CONCAT('Вкл.причин скидок: ',included_discountreason,'\n'),
                '')),
            (IF(excluded_discountreason!=0,
                CONCAT('Искл.причин скидок: ',excluded_discountreason,'\n'),
                '')),
            (IF(included_geographic_groups!=0,
                CONCAT('Вкл.частей города: ',included_geographic_groups,'\n'),
                '')),
            (IF(excluded_geographic_groups!=0,
                CONCAT('Искл.частей города: ',excluded_geographic_groups,'\n'),
                '')),
            (IF(included_payment_types!=0,
                CONCAT('Вкл.типов оплаты: ',included_payment_types,'\n'),
                '')),
            (IF(excluded_payment_types!=0,
                CONCAT('Искл.типов оплаты: ',excluded_payment_types,'\n'),
                '')),
            (IF(included_terminal_subtypes!=0,
                CONCAT('Вкл.источников оплаты по терминалу: ',included_terminal_subtypes,'\n'),
                '')),
            (IF(excluded_terminal_subtypes!=0,
                CONCAT('Искл.источников оплаты по терминалу: ',excluded_terminal_subtypes,'\n'),
                '')),
            (IF(included_promo_sets!=0,
                CONCAT('Вкл.промо-наборов: ',included_promo_sets,'\n'),
                '')),
            (IF(excluded_promo_sets!=0,
                CONCAT('Искл.промо-наборов: ',excluded_promo_sets,'\n'),
                '')),
            (IF(included_product_groups!=0,
                CONCAT('Вкл.групп товаров: ',included_product_groups,'\n'),
                ''))
        ) AS criterions
FROM
    (SELECT
         IF(
                     0 NOT IN (@Nomenclature_include),
                     (SELECT COUNT(id) FROM nomenclature WHERE nomenclature.id IN(@Nomenclature_include)),
                     0
             ) AS included_noms,
         IF(
                     0 NOT IN (@Nomenclature_exclude),
                     (SELECT COUNT(id) FROM nomenclature WHERE nomenclature.id IN(@Nomenclature_exclude)),
                     0
             ) AS excluded_noms,

         IF(
                     '0' NOT IN (@NomenclatureCategory_include),
                     (SELECT COUNT(q.cat) FROM (SELECT COUNT(nomenclature.category) AS cat FROM nomenclature WHERE nomenclature.category IN(@NomenclatureCategory_include) GROUP BY nomenclature.category) AS q),
                     0
             ) AS included_nomtypes,
         IF(
                     '0' NOT IN (@NomenclatureCategory_exclude),
                     (SELECT COUNT(q.cat) FROM (SELECT COUNT(nomenclature.category) AS cat FROM nomenclature WHERE nomenclature.category IN(@NomenclatureCategory_exclude) GROUP BY nomenclature.category) AS q),
                     0
             ) AS excluded_nomtypes,

         IF(
                     0 NOT IN (@Counterparty_include),
                     (SELECT COUNT(id) FROM counterparty WHERE counterparty.id IN(@Counterparty_include)),
                     0
             ) AS included_client,
         IF(
                     0 NOT IN (@Counterparty_exclude),
                     (SELECT COUNT(id) FROM counterparty WHERE counterparty.id IN(@Counterparty_exclude)),
                     0
             ) AS excluded_client,

         IF(
                     0 NOT IN (@Organization_include),
                     (SELECT COUNT(id) FROM organizations WHERE organizations.id IN(@Organization_include)),
                     0
             ) AS included_org,
         IF(
                     0 NOT IN (@Organization_exclude),
                     (SELECT COUNT(id) FROM organizations WHERE organizations.id IN(@Organization_exclude)),
                     0
             ) AS excluded_org,

         IF(
                     0 NOT IN (@Subdivision_include),
                     (SELECT COUNT(id) FROM subdivisions WHERE subdivisions.id IN(@Subdivision_include)),
                     0
             ) AS included_subdivision,
         IF(
                     0 NOT IN (@Subdivision_exclude),
                     (SELECT COUNT(id) FROM subdivisions WHERE subdivisions.id IN(@Subdivision_exclude)),
                     0
             ) AS excluded_subdivision,

         IF(
                     0 NOT IN (@Employee_include),
                     (SELECT COUNT(id) FROM employees WHERE employees.id IN(@Employee_include)),
                     0
             ) AS included_orderauthor,
         IF(
                     0 NOT IN (@Employee_exclude),
                     (SELECT COUNT(id) FROM employees WHERE employees.id IN(@Employee_exclude)),
                     0
             ) AS excluded_orderauthor,

         IF(
                     0 NOT IN (@DiscountReason_include),
                     (SELECT COUNT(id) FROM discount_reasons WHERE discount_reasons.id IN(@DiscountReason_include)),
                     0
             ) AS included_discountreason,
         IF(
                     0 NOT IN (@DiscountReason_exclude),
                     (SELECT COUNT(id) FROM discount_reasons WHERE discount_reasons.id IN(@DiscountReason_exclude)),
                     0
             ) AS excluded_discountreason,

         IF(
                     0 NOT IN (@GeoGroup_include),
                     (SELECT COUNT(id) FROM geo_groups WHERE geo_groups.id IN(@GeoGroup_include)),
                     0
             ) AS included_geographic_groups,
         IF(
                     0 NOT IN (@GeoGroup_exclude),
                     (SELECT COUNT(id) FROM geo_groups WHERE geo_groups.id IN(@GeoGroup_exclude)),
                     0
             ) AS excluded_geographic_groups,

         IF(
                     '0' NOT IN (@PaymentType_include),
                     (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_type) AS pay FROM orders WHERE orders.payment_type IN(@PaymentType_include) GROUP BY orders.payment_type) AS q),
                     0
             ) AS included_payment_types,
         IF(
                     '0' NOT IN (@PaymentType_exclude),
                     (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.payment_type) AS pay FROM orders WHERE orders.payment_type IN(@PaymentType_exclude) GROUP BY orders.payment_type) AS q),
                     0
             ) AS excluded_payment_types,
         IF(
                 '0' NOT IN (@PaymentByTerminalSource_include),
                 (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.terminal_subtype) AS pay FROM orders WHERE orders.terminal_subtype IN(@PaymentByTerminalSource_include) GROUP BY orders.terminal_subtype) AS q),
                 0
         ) AS included_terminal_subtypes,
         IF(
                     '0' NOT IN (@PaymentByTerminalSource_exclude),
                     (SELECT COUNT(q.pay) FROM (SELECT COUNT(orders.terminal_subtype) AS pay FROM orders WHERE orders.terminal_subtype IN(@PaymentByTerminalSource_exclude) GROUP BY orders.terminal_subtype) AS q),
                     0
             ) AS excluded_terminal_subtypes,
         IF(
                     0 NOT IN (@PromotionalSet_include),
                     (SELECT COUNT(id) FROM promotional_sets WHERE promotional_sets.id IN(@PromotionalSet_include)),
                     0
             ) AS included_promo_sets,
         IF(
                     0 NOT IN (@PromotionalSet_exclude),
                     (SELECT COUNT(id) FROM promotional_sets WHERE promotional_sets.id IN(@PromotionalSet_exclude)),
                     0
             ) AS excluded_promo_sets,
         IF(
                     0 NOT IN (@ProductGroup_include),
                     (SELECT COUNT(id) FROM nomenclature_groups WHERE nomenclature_groups.id IN(@ProductGroup_include)),
                     0
             ) AS included_product_groups,
         IF(
                     0 NOT IN (@ProductGroup_exclude),
                     (SELECT COUNT(id) FROM nomenclature_groups WHERE nomenclature_groups.id IN(@ProductGroup_exclude)),
                     0
             ) AS excluded_product_groups
    ) AS tbl
;</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>=Parameters!start_date</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>=Parameters!end_date</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_include">
            <Value>=Parameters!Nomenclature_include</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_exclude">
            <Value>=Parameters!Nomenclature_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_include">
            <Value>=Parameters!NomenclatureCategory_include</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_exclude">
            <Value>=Parameters!NomenclatureCategory_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>=Parameters!DiscountReason_include</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>=Parameters!DiscountReason_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>=Parameters!Organization_include</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>=Parameters!Organization_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>=Parameters!Counterparty_include</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>=Parameters!Counterparty_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>=Parameters!Employee_include</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>=Parameters!Employee_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>=Parameters!Subdivision_include</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>=Parameters!Subdivision_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>=Parameters!GeoGroup_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>=Parameters!GeoGroup_include</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="criterions">
          <DataField>criterions</DataField>
          <TypeName>System.String</TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="bottles">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <Timeout>600</Timeout>
        <CommandText>SELECT
    SUM(t.plan) AS plan,
    ROUND(SUM(t.fact), 0) AS fact
FROM
    (
        SELECT
            orders.bottles_return AS plan,
            IFNULL(route_list_addresses.bottles_returned,IFNULL(self_delivery.fact,0)) AS fact
        FROM
            orders
                LEFT JOIN route_list_addresses ON route_list_addresses.order_id = orders.id AND route_list_addresses.transfered_to_id IS NULL
                LEFT JOIN counterparty ON counterparty.id = orders.client_id
                LEFT JOIN delivery_points ON delivery_points.id = orders.delivery_point_id
                LEFT JOIN districts distr ON delivery_points.district_id = distr.id
                LEFT JOIN geo_groups gg ON gg.id = distr.geo_group_id
                LEFT JOIN counterparty_contract ON counterparty_contract.counterparty_id = counterparty.id
                LEFT JOIN employees ON employees.id = orders.author_employee_id
                LEFT JOIN subdivisions ON subdivisions.id = employees.subdivision_id
                LEFT JOIN order_items ON order_items.order_id = orders.id
                LEFT JOIN nomenclature ON nomenclature.id = order_items.nomenclature_id
                LEFT JOIN nomenclature_groups ON nomenclature.group_id = nomenclature_groups.id
                LEFT JOIN
            (
                SELECT
                    SUM(store_self_delivery_document_item.amount) AS fact,
                    store_self_delivery_document.order_id
                FROM
                    store_self_delivery_document
                        LEFT JOIN store_self_delivery_document_item ON store_self_delivery_document_item.store_self_delivery_document_id = store_self_delivery_document.id
                WHERE
                        store_self_delivery_document_item.nomenclature_id =
                        (
                            SELECT
                                base_parameters.str_value
                            FROM
                                base_parameters
                            WHERE
                                    base_parameters.name = 'default_bottle_nomenclature'
                            LIMIT 1
                        )
                GROUP BY store_self_delivery_document.order_id
            ) AS self_delivery ON self_delivery.order_id = orders.id
        WHERE
                orders.delivery_date &gt;= @start_date
          AND orders.delivery_date &lt;= @end_date
          AND !orders.is_contract_closer
          AND ( (0 IN (@Counterparty_include) AND 0 IN (@Counterparty_exclude)) OR EXISTS
            (
                SELECT * FROM order_items
                WHERE order_items.order_id = orders.id
                  AND (
                        ((order_items.discount_reason_id IN (@DiscountReason_include) AND 0 IN (@DiscountReason_exclude) )
                            OR
                         (order_items.discount_reason_id NOT IN (@DiscountReason_exclude) AND 0 IN (@DiscountReason_include)))
                        OR (0 IN (@DiscountReason_include) AND 0 IN (@DiscountReason_exclude))
                    )
            ))
          AND (
                ((orders.client_id IN (@Counterparty_include) AND 0 IN (@Counterparty_exclude) )
                    OR
                 (orders.client_id NOT IN (@Counterparty_exclude) AND 0 IN (@Counterparty_include)))
                OR (0 IN (@Counterparty_include) AND 0 IN (@Counterparty_exclude))
            )
          AND (
                ((counterparty_contract.organization_id IN (@Organization_include) AND 0 IN (@Organization_exclude) )
                    OR
                 (counterparty_contract.organization_id NOT IN (@Organization_exclude) AND 0 IN (@Organization_include)))
                OR (0 IN (@Organization_include) AND 0 IN (@Organization_exclude))
            )
          AND (
                ((IF(employees.subdivision_id IS NULL, 0, employees.subdivision_id) IN (@Subdivision_include) AND 0 IN (@Subdivision_exclude) )
                    OR
                 (IF(employees.subdivision_id IS NULL, 0, employees.subdivision_id) NOT IN (@Subdivision_exclude) AND 0 IN (@Subdivision_include)))
                OR (0 IN (@Subdivision_include) AND 0 IN (@Subdivision_exclude))
            )
          AND (
                ((IF(orders.author_employee_id IS NULL, 0, orders.author_employee_id) IN (@Employee_include) AND 0 IN (@Employee_exclude) )
                    OR
                 (IF(orders.author_employee_id IS NULL, 0, orders.author_employee_id) NOT IN (@Employee_exclude) AND 0 IN (@Employee_include)))
                OR (0 IN (@Employee_include) AND 0 IN (@Employee_exclude))
            )
          AND (
                ((IFNULL(gg.id, 0) IN (@GeoGroup_include) AND 0 IN (@GeoGroup_exclude) )
                    OR
                 (IFNULL(gg.id, 0) NOT IN (@GeoGroup_exclude) AND 0 IN (@GeoGroup_include)))
                OR (0 IN (@GeoGroup_include) AND 0 IN (@GeoGroup_exclude))
            )
          AND 
			(
	         (
	         	(
	         		(orders.payment_type IN (@PaymentType_include) AND '0' IN (@PaymentType_exclude))
	         		OR 
	         		(orders.payment_type = 'Terminal' AND orders.terminal_subtype IN (@PaymentByTerminalSource_include) AND '0' IN (@PaymentByTerminalSource_exclude))
	         	)
	            OR
	         	(
	          		(orders.payment_type NOT IN (@PaymentType_exclude) AND '0' IN (@PaymentType_include) AND '0' IN (@PaymentByTerminalSource_include))
	          		AND 
	          		(
	          			orders.payment_type &lt;&gt; 'Terminal'
	          			OR
	          			orders.payment_type = 'Terminal' AND orders.terminal_subtype NOT IN (@PaymentByTerminalSource_exclude)
	          		)          		
	         	)
	         )
	         OR ('0' IN (@PaymentType_include) AND '0' IN (@PaymentType_exclude) AND '0' IN (@PaymentByTerminalSource_include) AND '0' IN (@PaymentByTerminalSource_exclude))
	       )
          AND (
                ((IF(order_items.promotional_set_id IS NULL, 0, order_items.promotional_set_id) IN (@PromotionalSet_include) AND 0 IN (@PromotionalSet_exclude) )
                    OR
                 (IF(order_items.promotional_set_id IS NULL, 0, order_items.promotional_set_id) NOT IN (@PromotionalSet_exclude) AND 0 IN (@PromotionalSet_include)))
                OR (0 IN (@PromotionalSet_include) AND 0 IN (@PromotionalSet_exclude))
            )
          AND (
                ((IFNULL(nomenclature_groups.id , 0) IN (@ProductGroup_include) AND 0 IN (@ProductGroup_exclude) )
                    OR
                 (IFNULL(nomenclature_groups.id , 0) NOT IN (@ProductGroup_exclude) AND 0 IN (@ProductGroup_include)))
                OR (0 IN (@ProductGroup_include) AND 0 IN (@ProductGroup_exclude))
            )
        GROUP BY orders.id
    ) AS t</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>={?start_date}</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>={?end_date}</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>={?DiscountReason_include}</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>={?DiscountReason_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>={?Counterparty_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>={?Counterparty_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>={?Organization_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>={?Organization_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>={?Subdivision_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>={?Subdivision_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>={?Employee_include}</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>={?Employee_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>={?GeoGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>={?GeoGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="plan">
          <DataField>plan</DataField>
        </Field>
        <Field Name="fact">
          <DataField>fact</DataField>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="orders_count">
      <Query>
        <DataSourceName>DS1</DataSourceName>
        <Timeout>600</Timeout>
        <CommandText>SELECT
    COUNT(DISTINCT orders.id) as count
FROM
    order_items
        LEFT JOIN
    orders ON order_id = orders.id
        LEFT JOIN
    nomenclature ON order_items.nomenclature_id = nomenclature.id
        LEFT JOIN
    nomenclature_groups ON nomenclature.group_id = nomenclature_groups.id
        LEFT JOIN
    counterparty ON orders.client_id = counterparty.id
        LEFT JOIN
    delivery_points ON orders.delivery_point_id = delivery_points.id
        LEFT JOIN
    counterparty_contract ON orders.counterparty_contract_id = counterparty_contract.id
        LEFT JOIN
    employees ON orders.author_employee_id = employees.id
        LEFT JOIN
    districts distr ON delivery_points.district_id = distr.id
        LEFT JOIN
    geo_groups gg ON gg.id = distr.geo_group_id
WHERE
    (order_status = 'Accepted'
        OR order_status = 'InTravelList'
        OR order_status = 'OnLoading'
        OR order_status = 'OnTheWay'
        OR order_status = 'Shipped'
        OR order_status = 'UnloadingOnStock'
        OR order_status = 'Closed'
        OR (order_status = 'WaitForPayment' AND self_delivery AND pay_after_shipment)
        )
  AND (delivery_date &gt;= @start_date
    AND delivery_date &lt;= @end_date)
  AND !orders.is_contract_closer
  AND (
        ((nomenclature.id IN (@Nomenclature_include) AND 0 IN (@Nomenclature_exclude) )
            OR
         (nomenclature.id NOT IN (@Nomenclature_exclude) AND 0 IN (@Nomenclature_include)))
        OR (0 IN (@Nomenclature_include) AND 0 IN (@Nomenclature_exclude))
    )
  AND (
        ((nomenclature.category IN (@NomenclatureCategory_include) AND '0' IN (@NomenclatureCategory_exclude) )
            OR
         (nomenclature.category NOT IN (@NomenclatureCategory_exclude) AND '0' IN (@NomenclatureCategory_include)))
        OR ('0' IN (@NomenclatureCategory_include) AND '0' IN (@NomenclatureCategory_exclude))
    )
  AND (
        ((orders.client_id IN (@Counterparty_include) AND 0 IN (@Counterparty_exclude) )
            OR
         (orders.client_id NOT IN (@Counterparty_exclude) AND 0 IN (@Counterparty_include)))
        OR (0 IN (@Counterparty_include) AND 0 IN (@Counterparty_exclude))
    )
  AND (
        ((counterparty_contract.organization_id IN (@Organization_include) AND 0 IN (@Organization_exclude) )
            OR
         (counterparty_contract.organization_id NOT IN (@Organization_exclude) AND 0 IN (@Organization_include)))
        OR (0 IN (@Organization_include) AND 0 IN (@Organization_exclude))
    )
  AND (
        ((order_items.discount_reason_id IN (@DiscountReason_include) AND 0 IN (@DiscountReason_exclude) )
            OR
         (order_items.discount_reason_id NOT IN (@DiscountReason_exclude) AND 0 IN (@DiscountReason_include)))
        OR (0 IN (@DiscountReason_include) AND 0 IN (@DiscountReason_exclude))
    )
  AND (
        ((IF(employees.subdivision_id IS NULL, 0, employees.subdivision_id) IN (@Subdivision_include) AND 0 IN (@Subdivision_exclude) )
            OR
         (IF(employees.subdivision_id IS NULL, 0, employees.subdivision_id) NOT IN (@Subdivision_exclude) AND 0 IN (@Subdivision_include)))
        OR (0 IN (@Subdivision_include) AND 0 IN (@Subdivision_exclude))
    )
  AND (
        ((IF(orders.author_employee_id IS NULL, 0, orders.author_employee_id) IN (@Employee_include) AND 0 IN (@Employee_exclude) )
            OR
         (IF(orders.author_employee_id IS NULL, 0, orders.author_employee_id) NOT IN (@Employee_exclude) AND 0 IN (@Employee_include)))
        OR (0 IN (@Employee_include) AND 0 IN (@Employee_exclude))
    )
  AND (
        ((IFNULL(gg.id, 0) IN (@GeoGroup_include) AND 0 IN (@GeoGroup_exclude))
            OR
         (IFNULL(gg.id, 0) NOT IN (@GeoGroup_exclude) AND 0 IN (@GeoGroup_include)))
        OR (0 IN (@GeoGroup_include) AND 0 IN (@GeoGroup_exclude))
    )
  AND 
	(
     (
     	(
     		(orders.payment_type IN (@PaymentType_include) AND '0' IN (@PaymentType_exclude))
     		OR 
     		(orders.payment_type = 'Terminal' AND orders.terminal_subtype IN (@PaymentByTerminalSource_include) AND '0' IN (@PaymentByTerminalSource_exclude))
     	)
        OR
     	(
      		(orders.payment_type NOT IN (@PaymentType_exclude) AND '0' IN (@PaymentType_include) AND '0' IN (@PaymentByTerminalSource_include))
      		AND 
      		(
      			orders.payment_type &lt;&gt; 'Terminal'
      			OR
      			orders.payment_type = 'Terminal' AND orders.terminal_subtype NOT IN (@PaymentByTerminalSource_exclude)
      		)          		
     	)
     )
     OR ('0' IN (@PaymentType_include) AND '0' IN (@PaymentType_exclude) AND '0' IN (@PaymentByTerminalSource_include) AND '0' IN (@PaymentByTerminalSource_exclude))
   )
  AND (
        ((IFNULL(order_items.promotional_set_id, 0) IN (@PromotionalSet_include) AND 0 IN (@PromotionalSet_exclude))
            OR
         (IFNULL(order_items.promotional_set_id, 0) NOT IN (@PromotionalSet_exclude) AND 0 IN (@PromotionalSet_include)))
        OR (0 IN (@PromotionalSet_include) AND 0 IN (@PromotionalSet_exclude))
    )
  AND (
        ((IFNULL(nomenclature_groups.id , 0) IN (@ProductGroup_include) AND 0 IN (@ProductGroup_exclude))
            OR
         (IFNULL(nomenclature_groups.id , 0) NOT IN (@ProductGroup_exclude) AND 0 IN (@ProductGroup_include)))
        OR (0 IN (@ProductGroup_include) AND 0 IN (@ProductGroup_exclude))
    );</CommandText>
        <QueryParameters>
          <QueryParameter Name="start_date">
            <Value>=Parameters!start_date</Value>
          </QueryParameter>
          <QueryParameter Name="end_date">
            <Value>=Parameters!end_date</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_include">
            <Value>=Parameters!Nomenclature_include</Value>
          </QueryParameter>
          <QueryParameter Name="Nomenclature_exclude">
            <Value>=Parameters!Nomenclature_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_include">
            <Value>=Parameters!NomenclatureCategory_include</Value>
          </QueryParameter>
          <QueryParameter Name="NomenclatureCategory_exclude">
            <Value>=Parameters!NomenclatureCategory_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_include">
            <Value>=Parameters!DiscountReason_include</Value>
          </QueryParameter>
          <QueryParameter Name="DiscountReason_exclude">
            <Value>=Parameters!DiscountReason_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_include">
            <Value>=Parameters!Organization_include</Value>
          </QueryParameter>
          <QueryParameter Name="Organization_exclude">
            <Value>=Parameters!Organization_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_include">
            <Value>=Parameters!Counterparty_include</Value>
          </QueryParameter>
          <QueryParameter Name="Counterparty_exclude">
            <Value>=Parameters!Counterparty_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_include">
            <Value>=Parameters!Employee_include</Value>
          </QueryParameter>
          <QueryParameter Name="Employee_exclude">
            <Value>=Parameters!Employee_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_include">
            <Value>=Parameters!Subdivision_include</Value>
          </QueryParameter>
          <QueryParameter Name="Subdivision_exclude">
            <Value>=Parameters!Subdivision_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_include">
            <Value>=Parameters!GeoGroup_include</Value>
          </QueryParameter>
          <QueryParameter Name="GeoGroup_exclude">
            <Value>=Parameters!GeoGroup_exclude</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_include">
            <Value>={?PaymentType_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentType_exclude">
            <Value>={?PaymentType_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_include">
            <Value>={?PromotionalSet_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PromotionalSet_exclude">
            <Value>={?PromotionalSet_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_include">
            <Value>={?ProductGroup_include}</Value>
          </QueryParameter>
          <QueryParameter Name="ProductGroup_exclude">
            <Value>={?ProductGroup_exclude}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_include">
            <Value>={?PaymentByTerminalSource_include}</Value>
          </QueryParameter>
          <QueryParameter Name="PaymentByTerminalSource_exclude">
            <Value>={?PaymentByTerminalSource_exclude}</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
      <Fields>
        <Field Name="count">
          <DataField>count</DataField>
          <TypeName>System.Int32</TypeName>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
  <DataElementName>Report</DataElementName>
  <DataElementStyle>AttributeNormal</DataElementStyle>
  <DataSources>
    <DataSource Name="DS1">
      <ConnectionProperties>
        <DataProvider>MySqlConnector</DataProvider>
        <ConnectString></ConnectString>
        <IntegratedSecurity>false</IntegratedSecurity>
      </ConnectionProperties>
    </DataSource>
  </DataSources>
  <ReportParameters >
    <ReportParameter Name="start_date">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="end_date">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Nomenclature_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Nomenclature_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="NomenclatureCategory_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="NomenclatureCategory_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Counterparty_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Counterparty_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Organization_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Organization_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="DiscountReason_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="DiscountReason_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Employee_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Employee_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Subdivision_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="Subdivision_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="GeoGroup_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="GeoGroup_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentType_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentType_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PromotionalSet_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PromotionalSet_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="creation_date">
      <DataType>DateTime</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>false</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="ProductGroup_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="ProductGroup_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentByTerminalSource_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentByTerminalSource_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentFrom_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="PaymentFrom_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt></Prompt>
    </ReportParameter>
    <ReportParameter Name="OrderStatus_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
    <ReportParameter Name="OrderStatus_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
    <ReportParameter Name="CounterpartyType_include">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
    <ReportParameter Name="CounterpartyType_exclude">
      <DataType>String</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
    <ReportParameter Name="CounterpartySubtype_include">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
    <ReportParameter Name="CounterpartySubtype_exclude">
      <DataType>Integer</DataType>
      <Nullable>false</Nullable>
      <AllowBlank>false</AllowBlank>
      <MultiValue>true</MultiValue>
      <Prompt />
    </ReportParameter>
  </ReportParameters>
</Report>